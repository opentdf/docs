<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-spec/protocol/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Protocol | OpenTDF</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.opentdf.io/pr-172/img/opentdf-social.png"><meta data-rh="true" name="twitter:image" content="https://docs.opentdf.io/pr-172/img/opentdf-social.png"><meta data-rh="true" property="og:url" content="https://docs.opentdf.io/pr-172/spec/protocol"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Protocol | OpenTDF"><meta data-rh="true" name="description" content="This section describes the interaction protocols between OpenTDF clients (SDKs) and Key Access Servers (KAS) for securely managing access to the Data Encryption Keys (DEKs) used to protect TDF payloads."><meta data-rh="true" property="og:description" content="This section describes the interaction protocols between OpenTDF clients (SDKs) and Key Access Servers (KAS) for securely managing access to the Data Encryption Keys (DEKs) used to protect TDF payloads."><link data-rh="true" rel="icon" href="/pr-172/img/OpenTDF-Logo.png"><link data-rh="true" rel="canonical" href="https://docs.opentdf.io/pr-172/spec/protocol"><link data-rh="true" rel="alternate" href="https://docs.opentdf.io/pr-172/spec/protocol" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.opentdf.io/pr-172/spec/protocol" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Specification","item":"https://docs.opentdf.io/pr-172/spec/"},{"@type":"ListItem","position":2,"name":"Protocol","item":"https://docs.opentdf.io/pr-172/spec/protocol/"}]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","name":"OpenTDF","url":"https://opentdf.io","logo":"https://docs.opentdf.io/img/opentdf-social.png"}</script><link rel="stylesheet" href="/pr-172/assets/css/styles.d388913b.css">
<script src="/pr-172/assets/js/runtime~main.acb04d16.js" defer="defer"></script>
<script src="/pr-172/assets/js/main.065347f5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/pr-172/"><div class="navbar__logo"><img src="/pr-172/img/OpenTDF-Logo.png" alt="OpenTDF - Protect the Data, Build the Future" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/pr-172/img/OpenTDF-Logo.png" alt="OpenTDF - Protect the Data, Build the Future" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">OpenTDF</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pr-172/introduction">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/opentdf" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/pr-172/"><img src="/pr-172/img/OpenTDF-Logo.png" alt="OpenTDF - Protect the Data, Build the Future" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/pr-172/img/OpenTDF-Logo.png" alt="OpenTDF - Protect the Data, Build the Future" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"><b>OpenTDF</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-172/introduction">Welcome to OpenTDF Docs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-172/getting-started">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-172/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-172/category/components-and-services">Components and Services</a><button aria-label="Expand sidebar category &#x27;Components and Services&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-172/category/sdk">SDK</a><button aria-label="Expand sidebar category &#x27;SDK&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-172/OpenAPI-clients">OpenAPI Clients</a><button aria-label="Expand sidebar category &#x27;OpenAPI Clients&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/pr-172/spec">Specification</a><button aria-label="Collapse sidebar category &#x27;Specification&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/pr-172/category/concepts">Concepts</a><button aria-label="Expand sidebar category &#x27;Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pr-172/spec/protocol">Protocol</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/pr-172/spec/schema">Schema</a><button aria-label="Expand sidebar category &#x27;Schema&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/pr-172/appendix/matrix">Appendix</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-172/release-notes">Release Notes</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_xLCN"><div class="docItemContainer_jfFK"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/pr-172/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/pr-172/spec"><span>Specification</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Protocol</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="row"><div class="col col--12 markdown"><header><h1>OpenTDF Protocols</h1></header>
<p>This section describes the interaction protocols between OpenTDF clients (SDKs) and Key Access Servers (KAS) for securely managing access to the Data Encryption Keys (DEKs) used to protect TDF payloads.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="protocol-selection-and-crypto-agility">Protocol Selection and Crypto-Agility<a href="#protocol-selection-and-crypto-agility" class="hash-link" aria-label="Direct link to Protocol Selection and Crypto-Agility" title="Direct link to Protocol Selection and Crypto-Agility">​</a></h2>
<p>A core design principle of OpenTDF is <strong>crypto-agility</strong>. The specific cryptographic algorithms and protocols used for key wrapping and KAS communication are not rigidly fixed by the core TDF structure. Instead, each <a href="/pr-172/spec/schema/opentdf/key_access_object">Key Access Object</a> within a TDF&#x27;s manifest specifies:</p>
<ol>
<li>The <strong>URL</strong> of the responsible KAS.</li>
<li>The <strong>protocol</strong> identifier (e.g., <code>wrapped</code>) indicating how to interact with that KAS.</li>
<li>A <strong>Key Identifier (<code>kid</code>)</strong> referencing a specific KAS public key.</li>
<li>A <strong>Split Identifier (<code>sid</code>)</strong> uniquely identifying a key share when the DEK is split across multiple KAS instances for multi-party access control</li>
</ol>
<p>This allows different <code>keyAccess</code> objects within the <em>same</em> TDF to potentially use different key wrapping mechanisms (e.g., one KAS using RSA, another using ECIES based on Elliptic Curve Cryptography) or evolve independently to adopt new algorithms, such as post-quantum cryptography, without breaking the overall TDF format.</p>
<p>The client SDK MUST interpret the details within a specific <code>keyAccess</code> object to determine how to interact with the corresponding KAS.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="general-interaction-flow">General Interaction Flow<a href="#general-interaction-flow" class="hash-link" aria-label="Direct link to General Interaction Flow" title="Direct link to General Interaction Flow">​</a></h2>
<p>While specific protocols vary, the high-level interaction generally follows these phases:</p>
<ol>
<li><strong>TDF Creation:</strong> The SDK encrypts the payload with a generated DEK, defines the access policy, wraps the DEK using the target KAS&#x27;s public key(s) according to the chosen protocol(s), calculates policy bindings, and constructs the manifest.</li>
<li><strong>Access Request:</strong> A client SDK parses the TDF manifest, identifies the relevant <code>keyAccess</code> object(s), and sends a request to the specified KAS URL(s). This request includes the wrapped key(s), policy binding information, the policy itself, and client authentication/authorization context (including the client&#x27;s public key for rewrapping).</li>
<li><strong>KAS Verification:</strong> The KAS authenticates the client, decrypts the wrapped DEK share(s) using its private key, validates the policy binding against the provided policy and the decrypted DEK share, and performs the authorization check (evaluating the policy against the client&#x27;s authenticated attributes).</li>
<li><strong>Key Rewrap &amp; Response:</strong> If all checks pass, the KAS re-encrypts (&quot;rewraps&quot;) the DEK share using the client&#x27;s public key provided in the request and returns it. If any check fails, the KAS returns an error.</li>
<li><strong>Payload Decryption:</strong> The client SDK decrypts the rewrapped DEK share(s) using its private key, reconstructs the full DEK (if key splitting was used), and uses the DEK to decrypt the TDF payload, verifying payload integrity simultaneously.</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="example-protocol-rsa-key-wrapping">Example Protocol: RSA Key Wrapping<a href="#example-protocol-rsa-key-wrapping" class="hash-link" aria-label="Direct link to Example Protocol: RSA Key Wrapping" title="Direct link to Example Protocol: RSA Key Wrapping">​</a></h2>
<p>The <a href="https://github.com/opentdf/platform" target="_blank" rel="noopener noreferrer">OpenTDF reference implementation (opentdf/platform)</a> demonstrates specific protocols. Below is a detailed example flow using <strong>RSA</strong> for wrapping the DEK. This assumes a scenario with a single KAS for simplicity.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tdf-creation-encryption-flow">TDF Creation (Encryption Flow)<a href="#tdf-creation-encryption-flow" class="hash-link" aria-label="Direct link to TDF Creation (Encryption Flow)" title="Direct link to TDF Creation (Encryption Flow)">​</a></h3>
<p><em>Executed by the OpenTDF Client/SDK</em></p>
<ol>
<li><strong>Generate DEK:</strong> Generate a cryptographically strong symmetric Data Encryption Key (DEK) (e.g., AES-256).</li>
<li><strong>Encrypt Payload:</strong> Encrypt the original payload data using the DEK and an authenticated encryption mode (e.g., AES-256-GCM), generating an Initialization Vector (IV) and integrity tags per segment. Store the IV and segment information.</li>
<li><strong>Define Policy:</strong> Construct the <a href="/pr-172/spec/schema/opentdf/policy">Policy Object</a> JSON defining the required attributes (<code>dataAttributes</code>) and dissemination list (<code>dissem</code>). Base64 encode this JSON string.</li>
<li><strong>Generate Policy Binding:</strong> Calculate the policy binding hash: <code>HMAC(DEK, Base64(policyJSON))</code> using a standard algorithm like HMAC-SHA256. Base64 encode the resulting hash.</li>
<li><strong>Prepare Optional Metadata:</strong> If client-specific metadata needs to be passed securely to the KAS during decryption, prepare this data.</li>
<li><strong>Encrypt Optional Metadata:</strong> Encrypt the prepared metadata using the DEK (e.g., AES-GCM). Base64 encode the ciphertext. The encypted metadata is always passed to the KAS for processing, but from the perspective of a developer using the SDK, it is optional.</li>
<li><strong>Fetch KAS Public Key:</strong> Obtain the target KAS&#x27;s RSA public key (identified by the KAS URL and potentially a <code>kid</code>). This might involve a separate discovery step or be pre-configured.</li>
<li><strong>Wrap DEK:</strong> Encrypt the plaintext DEK using the KAS&#x27;s RSA public key (e.g., using RSAES-OAEP). Base64 encode the resulting ciphertext.</li>
<li><strong>Construct Key Access Object:</strong> Create the <a href="/pr-172/spec/schema/opentdf/key_access_object">Key Access Object</a> including:<!-- -->
<ul>
<li><code>type</code>: &quot;wrapped&quot;</li>
<li><code>url</code>: KAS URL</li>
<li><code>protocol</code>: &quot;kas&quot; (or a more specific identifier if needed)</li>
<li><code>kid</code>: Identifier of the KAS key used.</li>
<li><code>wrappedKey</code>: Base64 encoded wrapped DEK from step 8.</li>
<li><code>policyBinding</code>: Object containing <code>alg</code> (e.g., &quot;HS256&quot;) and the Base64 encoded <code>hash</code> from step 4.</li>
<li><code>encryptedMetadata</code>: (Optional) Base64 encoded encrypted metadata from step 6.</li>
</ul>
</li>
<li><strong>Construct Manifest:</strong> Assemble the full <code>manifest.json</code> including the <code>payload</code>, <code>encryptionInformation</code> (containing the <code>keyAccess</code> object(s), <code>method</code>, <code>integrityInformation</code>, and <code>policy</code> string), and any <code>assertions</code>.</li>
<li><strong>Package TDF:</strong> Create the Zip archive containing <code>manifest.json</code> and the encrypted payload file.</li>
<li><strong>Securely Discard DEK:</strong> Erase the plaintext DEK from memory immediately after it has been wrapped and used for metadata encryption/bindings. It should <em>never</em> be stored persistently by the encrypting client.</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tdf-access-decryption-flow">TDF Access (Decryption Flow)<a href="#tdf-access-decryption-flow" class="hash-link" aria-label="Direct link to TDF Access (Decryption Flow)" title="Direct link to TDF Access (Decryption Flow)">​</a></h3>
<p><em>Involves interaction between Client/SDK and KAS</em></p>
<!-- -->
<p><strong>Phase 1: Client Preparation &amp; Request</strong> <em>(Executed by SDK)</em></p>
<ol>
<li><strong>Parse Manifest:</strong> Read the TDF&#x27;s <code>manifest.json</code>.</li>
<li><strong>Identify KAS Target(s):</strong> Select the appropriate <a href="/pr-172/spec/schema/opentdf/key_access_object">Key Access Object</a>(s) based on desired KAS or required key shares (<code>sid</code> if splitting).</li>
<li><strong>Extract Information:</strong> From the selected <code>keyAccess</code> object(s), extract the KAS <code>url</code>, <code>wrappedKey</code>, <code>policyBinding</code> object, and optionally <code>encryptedMetadata</code>. Extract the Base64 <code>policy</code> string from <code>encryptionInformation</code>.</li>
<li><strong>Prepare Client Context:</strong> Obtain the client&#x27;s authentication credentials (e.g., OAuth token) and the client&#x27;s public key (corresponding to the private key the client will use for decryption).</li>
<li><strong>Construct Rewrap Request:</strong> Create a request payload (typically JSON) containing:<!-- -->
<ul>
<li>The <code>wrappedKey</code> to be rewrapped.</li>
<li>The <code>policyBinding</code> object (<code>alg</code> and <code>hash</code>).</li>
<li>The Base64 <code>policy</code> string.</li>
<li>(Optional) The <code>encryptedMetadata</code>.</li>
<li>The client&#x27;s public key (for the KAS to rewrap the DEK).</li>
<li>Client authentication/authorization information (e.g., in HTTP headers).</li>
</ul>
</li>
<li><strong>Send Request:</strong> POST the request payload to the KAS endpoint (e.g., <code>{KAS_URL}/v1/rewrap</code>).</li>
</ol>
<p><strong>Phase 2: KAS Processing &amp; Verification</strong> <em>(Executed by KAS)</em></p>
<ol start="7">
<li><strong>Authenticate Client:</strong> Verify the client&#x27;s authentication credentials. If invalid, return an authentication error.</li>
<li><strong>Decrypt DEK Share:</strong> Use the KAS&#x27;s <em>private</em> RSA key (corresponding to the public key used for wrapping, identified by <code>kid</code>) to decrypt the <code>wrappedKey</code> provided in the request, yielding the plaintext DEK share.</li>
<li><strong>Validate Policy Binding:</strong>
<ul>
<li>Recalculate the HMAC: <code>HMAC(DEK share, policy string from request)</code> using the algorithm specified in the request&#x27;s <code>policyBinding.alg</code>.</li>
<li>Compare the recalculated HMAC hash with the <code>policyBinding.hash</code> provided in the request.</li>
<li>If they do not match, return a policy binding error (indicates tampering or mismatch).</li>
</ul>
</li>
<li><strong>(Optional) Decrypt Metadata:</strong> If <code>encryptedMetadata</code> was provided, decrypt it using the plaintext DEK share. This metadata might inform policy decisions or logging.</li>
<li><strong>Perform Authorization Check:</strong>
<ul>
<li>Retrieve the requesting client&#x27;s validated attributes/entitlements (based on their authenticated identity).</li>
<li>Parse the <code>policy</code> string from the request to get the required <code>dataAttributes</code> and <code>dissem</code> list.</li>
<li>Evaluate the policy rules (potentially retrieving external Attribute Definitions) against the client&#x27;s attributes.</li>
<li>Check if the client is in the <code>dissem</code> list (if applicable).</li>
<li>If authorization fails (policy requirements not met), return an authorization error.</li>
</ul>
</li>
<li><strong>Rewrap DEK Share:</strong> If all checks pass, encrypt the plaintext DEK share using the client&#x27;s public key provided in the request (e.g., using RSAES-OAEP if the client key is RSA). Base64 encode the result.</li>
<li><strong>Send Response:</strong> Return a success response containing the Base64 encoded, rewrapped DEK share.</li>
</ol>
<p><strong>Phase 3: Client Decryption</strong> <em>(Executed by SDK)</em></p>
<ol start="14">
<li><strong>Receive Response:</strong> Get the response from the KAS. Check for errors (authentication, binding, authorization failures).</li>
<li><strong>Decrypt DEK Share:</strong> If the request was successful, use the client&#x27;s <em>private</em> key to decrypt the rewrapped DEK share received from the KAS.</li>
<li><strong>(If Key Splitting) Reconstruct DEK:</strong> If multiple shares were required (<code>sid</code> was used), combine the decrypted shares (e.g., via XOR) to reconstruct the full plaintext DEK.</li>
<li><strong>Decrypt Payload:</strong> Use the plaintext DEK and the parameters from <code>encryptionInformation.method</code> (IV) to decrypt the TDF payload. During decryption (especially with AES-GCM or streaming), simultaneously verify the integrity of each segment using the <code>hash</code> from the <a href="/pr-172/spec/schema/opentdf/integrity_information">Segment Object</a> and finally verify the <code>rootSignature</code> from <a href="/pr-172/spec/schema/opentdf/integrity_information"><code>integrityInformation</code></a>. If any integrity check fails, abort decryption and report an error.</li>
<li><strong>Securely Discard DEK:</strong> Once the payload is decrypted or decryption fails, securely erase the plaintext DEK and any intermediate shares from memory.</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="error-handling">Error Handling<a href="#error-handling" class="hash-link" aria-label="Direct link to Error Handling" title="Direct link to Error Handling">​</a></h2>
<p>KAS implementations SHOULD return standard HTTP error codes and informative error messages (without revealing sensitive internal state) for failed requests, clearly distinguishing between:</p>
<ul>
<li>Authentication failures (401/403)</li>
<li>Policy Binding validation failures (e.g., 400 Bad Request or 403 Forbidden)</li>
<li>Authorization failures (policy denied) (403 Forbidden)</li>
<li>Invalid input or malformed requests (400 Bad Request)</li>
<li>Internal server errors (500)</li>
</ul>
<p>Clients MUST handle these errors appropriately.</p></div></div></div><div class="row"><div class="col col--12"></div></div></article><div class="row"><div class="col col--12"><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/pr-172/spec/concepts/security"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Security</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pr-172/spec/schema"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">OpenTDF</div></a></nav></div></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#protocol-selection-and-crypto-agility" class="table-of-contents__link toc-highlight">Protocol Selection and Crypto-Agility</a></li><li><a href="#general-interaction-flow" class="table-of-contents__link toc-highlight">General Interaction Flow</a></li><li><a href="#example-protocol-rsa-key-wrapping" class="table-of-contents__link toc-highlight">Example Protocol: RSA Key Wrapping</a><ul><li><a href="#tdf-creation-encryption-flow" class="table-of-contents__link toc-highlight">TDF Creation (Encryption Flow)</a></li><li><a href="#tdf-access-decryption-flow" class="table-of-contents__link toc-highlight">TDF Access (Decryption Flow)</a></li></ul></li><li><a href="#error-handling" class="table-of-contents__link toc-highlight">Error Handling</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Sponsors</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://virtru.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Virtru<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Support</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/pr-172/getting-started/configuration">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/pr-172/introduction">Documentation</a></li><li class="footer__item"><a href="https://github.com/orgs/opentdf/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/orgs/opentdf/discussions/categories/show-and-tell" target="_blank" rel="noopener noreferrer" class="footer__link-item">Showcase<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/orgs/opentdf/discussions/1806" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roadmap<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/pr-172/privacy-policy">Privacy Policy</a></li><li class="footer__item"><a class="footer__link-item" href="/pr-172/cookie-policy">Cookie Policy</a></li><li class="footer__item"><a class="footer__link-item" href="/pr-172/terms-of-service">Terms of Service</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opentdf.io" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/pr-172/img/opentdf-logo-horizontal.png" alt="OpenTDF Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/pr-172/img/opentdf-logo-horizontal.png" alt="OpenTDF Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">
          <span>Copyright © 2026 OpenTDF</span>
          <iconify-icon data-icon="mdi:shield-check" style="color: #00FF00;"></iconify-icon>
        </div></div></div></footer></div>
</body>
</html>
"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1202],{35579:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>p});const t=JSON.parse('{"id":"components/policy/keymanagement/key_mappings","title":"Key mappings","description":"Before leveraging Key Mappings make sure to migrate your existing KAS Grants.","source":"@site/docs/components/policy/keymanagement/key_mappings.md","sourceDirName":"components/policy/keymanagement","slug":"/components/policy/keymanagement/key_mappings","permalink":"/pr-172/components/policy/keymanagement/key_mappings","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"slug":"/components/policy/keymanagement/key_mappings"},"sidebar":"tutorialSidebar","previous":{"title":"Key Managers","permalink":"/pr-172/components/policy/keymanagement/key_managers"},"next":{"title":"Quickstart for using the new key management architecture","permalink":"/pr-172/components/policy/keymanagement/quickstart"}}');var s=a(74848),r=a(28453);const i={sidebar_position:1,slug:"/components/policy/keymanagement/key_mappings"},o="Key mappings",c={},p=[{value:"How do I create a key mapping",id:"how-do-i-create-a-key-mapping",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"key-mappings",children:"Key mappings"})}),"\n",(0,s.jsx)(n.admonition,{type:"important",children:(0,s.jsxs)(n.p,{children:["Before leveraging Key Mappings make sure to ",(0,s.jsx)(n.a,{href:"/pr-172/components/policy/key_access_grants#migration-to-key-mappings",children:"migrate"})," your existing KAS Grants."]})}),"\n",(0,s.jsx)(n.admonition,{type:"important",children:(0,s.jsxs)(n.p,{children:["v0.5.0 of the SDK will prefer key mappings over\ngrants. Meaning if a key mapping shows up for an attribute\nthe SDK will use the mapping and not the grant.\nYou ",(0,s.jsx)(n.strong,{children:"should"})," migrate all grants over to mappings in one\nsitting"]})}),"\n",(0,s.jsx)(n.admonition,{type:"important",children:(0,s.jsx)(n.p,{children:"As of v0.7.0 of the OpenTDF platform,\ngrants can no longer be assigned."})}),"\n",(0,s.jsxs)(n.p,{children:["Key mappings are now the replacement for key access server grants. The idea for mapping a key to an attribute definition/value/namespace is the same as grants, except now we separate the keys from key access servers. Previously an admin was expected to add a key directly to the KeyAccessServer object, as either ",(0,s.jsx)(n.strong,{children:"remote"})," or ",(0,s.jsx)(n.strong,{children:"cached"}),", and then assign a key access server to an attribute. That process is known as a grant. Now users should create a key, and assign that key to an attribute."]}),"\n",(0,s.jsx)(n.h2,{id:"how-do-i-create-a-key-mapping",children:"How do I create a key mapping"}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"The following example only shows how to create a mapping for\nattribute definitions, you can also create mappings for namespaces\nand attribute values."})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["First you will need to ",(0,s.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/policy/kasregistry/key_access_server_registry.proto#L59",children:"create a key access server"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"OpenTDF CLI"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"otdfctl policy kas-registry create --uri http://example.com/kas --name example-kas\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Next, you will need to ",(0,s.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/policy/kasregistry/key_access_server_registry.proto#L379",children:"create a key"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"OpenTDF CLI"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'otdfctl key create --key-id "rsa-key-1" --algorithm "rsa:2048" --mode "local" --kas "891cfe85-b381-4f85-9699-5f7dbfe2a9ab" --wrapping-key-id "virtru-stored-key" --wrapping-key "a8c4824daafcfa38ed0d13002e92b08720e6c4fcee67d52e954c1a6e045907d1"\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/policy/namespaces/namespaces.proto#L95",children:"create a namespace"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"OpenTDF CLI"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"otdfctl policy attributes namespaces create --name opentdf.io\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/policy/attributes/attributes.proto#L116",children:"create an attribute"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"OpenTDF CLI"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"otdfctl policy attributes create --namespace 3d25d33e-2469-4990-a9ed-fdd13ce74436 --name myattribute --rule ANY_OF\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/policy/attributes/attributes.proto#L356",children:"assign a key to an attribute"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"OpenTDF CLI"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"otdfctl policy attributes key assign --attribute 3d25d33e-2469-4990-a9ed-fdd13ce74436 --key-id 8f7e6d5c-4b3a-2d1e-9f8d-7c6b5a432f1d\n"})}),"\n",(0,s.jsx)(n.p,{children:"Now you have successfully created a key mapping."})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>o});var t=a(96540);const s={},r=t.createContext(s);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);
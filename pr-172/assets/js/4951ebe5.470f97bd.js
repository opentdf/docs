"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1643],{94437:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"components/policy/keymanagement/index","title":"Key Management","description":"Key management is the new way for managing key encryption keys for the platform. Asymmetric keys or a reference to a key will now be stored either within the platform database directly, or stored externally using a Key Management Provider or a Hardware Security Module (abstracted as a Key Manager). Those keys will then be used for TDF creation and decryption.","source":"@site/docs/components/policy/keymanagement/index.md","sourceDirName":"components/policy/keymanagement","slug":"/components/policy/keymanagement","permalink":"/pr-172/components/policy/keymanagement","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"slug":"/components/policy/keymanagement"},"sidebar":"tutorialSidebar","previous":{"title":"Policy","permalink":"/pr-172/components/policy"},"next":{"title":"Base Key","permalink":"/pr-172/components/policy/keymanagement/base_key"}}');var a=n(74848),o=n(28453);const i={sidebar_position:1,slug:"/components/policy/keymanagement"},s="Key Management",c={},l=[{value:"How does everything work?",id:"how-does-everything-work",level:2},{value:"What is different with the new key architecture?",id:"what-is-different-with-the-new-key-architecture",level:2}];function d(e){const t={a:"a",admonition:"admonition",h1:"h1",h2:"h2",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"key-management",children:"Key Management"})}),"\n",(0,a.jsx)(t.p,{children:"Key management is the new way for managing key encryption keys for the platform. Asymmetric keys or a reference to a key will now be stored either within the platform database directly, or stored externally using a Key Management Provider or a Hardware Security Module (abstracted as a Key Manager). Those keys will then be used for TDF creation and decryption."}),"\n",(0,a.jsx)(t.h2,{id:"how-does-everything-work",children:"How does everything work?"}),"\n",(0,a.jsx)(t.mermaid,{value:"sequenceDiagram\n    User->>+SDK: Decrypt TDF\n    SDK->>+KAS: Rewrap key\n    KAS->>+Platform: Retrieve key\n    Platform->>+KAS: Returns key\n    KAS->>+Key Manager: Decrypt data encryption key\n    KAS->>+KAS: Key Manager performs rewrap of KAO\n    KAS->>+SDK: Return rewrapped key"}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.strong,{children:"key manager"})," is a part of the key access server, but is called out specifically because it is a new\nconcept for the platform. Read more about ",(0,a.jsx)(t.a,{href:"/pr-172/components/policy/keymanagement/key_managers",children:"managers"}),"."]})}),"\n",(0,a.jsx)(t.p,{children:"The graphic above is a representation of a basic flow of how KAS now would perform a rewrap (decrypt) operation.  KAS now needs to reach out to a third party to get the private key to rewrap the data encryption key that is sent in the rewrap request, which will then be unwrapped on the client and used to decrypt the payload of the TDF."}),"\n",(0,a.jsx)(t.p,{children:"In the example above, the KAS (key access server) reaches out to the platform to get a key, but it's totally possible with the new architecture that the platform database could only store a reference to the key. What this means is that the private key could be stored externally, say in a KMS or HSM, outside of the platform's control."}),"\n",(0,a.jsx)(t.p,{children:"The following is an example of how the code would work if you used a KMS, for all cryptographic operations:"}),"\n",(0,a.jsx)(t.mermaid,{value:"sequenceDiagram\n    User->>+SDK: Decrypt TDF\n    SDK->>+KAS: Rewrap key\n    KAS->>+Platform: Retrieve key reference\n    Platform->>+KAS: Returns key\n    KAS->>+Key Manager: Get unwrapped key\n    Key Manager->>+KMS: Reach out to KMS for unwrapped data encryption key\n    KAS->>+KAS: Perform rewrap\n    KAS->>+SDK: Return rewrapped key"}),"\n",(0,a.jsxs)(t.p,{children:["The primary difference is that the ",(0,a.jsx)(t.strong,{children:"Key Manager"})," needs to reach out to the KMS to perform the rewrap operation. To connect KAS to a specific external key provider you would need to use a ",(0,a.jsx)(t.a,{href:"/pr-172/components/policy/keymanagement/key_managers",children:"provider configuration"}),". To learn more about the following flow, read about ",(0,a.jsx)(t.a,{href:"/pr-172/components/policy/keymanagement/key_managers",children:"key managers"})]}),"\n",(0,a.jsx)(t.h2,{id:"what-is-different-with-the-new-key-architecture",children:"What is different with the new key architecture?"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Previously, when starting the platform users would be expected to populate the ",(0,a.jsx)(t.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/opentdf-dev.yaml#L160-L171",children:"startup yaml file"})," with asymmetric keys that would be used by KAS for and decryption. Now keys, or their reference, should be stored/registered with the platform via the ",(0,a.jsx)(t.a,{href:"https://github.com/opentdf/platform/blob/main/service/policy/kasregistry/key_access_server_registry.proto#L678-L699",children:"kas-registry key endpoints"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:["Endpoints for easier management of keys through the kas-registry.","\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsx)(t.li,{children:"Create/Read/Update"}),"\n",(0,a.jsx)(t.li,{children:"Key Rotation"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["Grants are being deprecated for ",(0,a.jsx)(t.a,{href:"/pr-172/components/policy/keymanagement/key_mappings",children:"key mappings"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:["Admins can now set a ",(0,a.jsx)(t.a,{href:"/pr-172/components/policy/keymanagement/base_key",children:"base key"})," to be used as the default key when no key mappings/grants are found."]}),"\n",(0,a.jsxs)(t.li,{children:["Asymmetric keys can now be stored outside of a Key Access Server, by registering a ",(0,a.jsx)(t.strong,{children:"key manager"})," at startup and creating a provider configuration that is tied to the key manager."]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>s});var r=n(96540);const a={},o=r.createContext(a);function i(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);
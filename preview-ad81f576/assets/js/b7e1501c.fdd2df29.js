"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[823],{97887:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"components/policy/keymanagement/key_managers","title":"Key Managers","description":"With the new key architecture OpenTDF has added the flexibility for an organization to store keys outside of a key access server or the platform. For example, if you want to use OpenTDF and your encryption keys are stored within AWS KMS, this is now totally possible through key managers.","source":"@site/docs/components/policy/keymanagement/key_managers.md","sourceDirName":"components/policy/keymanagement","slug":"/components/policy/keymanagement/key_managers","permalink":"/preview-ad81f576/components/policy/keymanagement/key_managers","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"slug":"/components/policy/keymanagement/key_managers"},"sidebar":"tutorialSidebar","previous":{"title":"Base Key","permalink":"/preview-ad81f576/components/policy/keymanagement/base_key"},"next":{"title":"Key mappings","permalink":"/preview-ad81f576/components/policy/keymanagement/key_mappings"}}');var r=a(74848),i=a(28453);const o={sidebar_position:1,slug:"/components/policy/keymanagement/key_managers"},s="Key Managers",c={},d=[{value:"What is a key manager?",id:"what-is-a-key-manager",level:2},{value:"How do I register a key manager?",id:"how-do-i-register-a-key-manager",level:2},{value:"Provider configurations",id:"provider-configurations",level:3},{value:"Helpful links",id:"helpful-links",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"key-managers",children:"Key Managers"})}),"\n",(0,r.jsxs)(n.p,{children:["With the new key architecture OpenTDF has added the flexibility for an organization to store keys outside of a key access server or the platform. For example, if you want to use OpenTDF and your encryption keys are stored within AWS KMS, this is now totally possible through ",(0,r.jsx)(n.strong,{children:"key managers"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"what-is-a-key-manager",children:"What is a key manager?"}),"\n",(0,r.jsxs)(n.p,{children:["A key manager is essentially a client that is used for either performing cryptographic operations or orchestrating the necessary procedures for retrieving the decrypted data encryption key, which can be used for decrypting the TDF. An example of a key manager can be found in the ",(0,r.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/main/service/internal/security/basic_manager.go",children:"basic manager"}),". The basic manager is the default manager, which expects the private key to be stored within the platform and the symmetric key that wraps the private key to be stored within KAS."]}),"\n",(0,r.jsx)(n.h2,{id:"how-do-i-register-a-key-manager",children:"How do I register a key manager?"}),"\n",(0,r.jsxs)(n.p,{children:["If you have written your own key manager, you can register it with KAS by providing its factory method with a ",(0,r.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/pkg/server/options.go#L141-L164",children:"server option"})," (.so), during server startup. By providing a way to instantiate an object of your key manager type we will then use it when necessary. You will also need to configure KAS to use the new key manager. This is done through provider configuration file (.cfg)."]}),"\n",(0,r.jsx)(n.admonition,{type:"important",children:(0,r.jsxs)(n.p,{children:["As of ",(0,r.jsx)(n.a,{href:"https://github.com/opentdf/platform/releases/tag/service%2Fv0.10.0",children:"Service v0.10.0"})," the use of the ",(0,r.jsx)(n.code,{children:"name"})," field is not used for mapping a key to an implementation of that manager. Instead,\nthe new ",(0,r.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/policy/keymanagement/key_management.proto#L22",children:"manager"})," field is used for this purpose. The ",(0,r.jsx)(n.code,{children:"name"})," should\nnow be treated as a friendly name."]})}),"\n",(0,r.jsx)(n.h3,{id:"provider-configurations",children:"Provider configurations"}),"\n",(0,r.jsxs)(n.p,{children:["Provider configurations are a way of entangling a key to a specific manager. The ",(0,r.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/policy/keymanagement/key_management.proto",children:"key management proto"})," provides specifics on what RPCs are available as well as what is expected within each call. One of the most important parts of the provider configuration is the ",(0,r.jsx)(n.strong,{children:"manager"})," field. The ",(0,r.jsx)(n.strong,{children:"manager"})," field is what KAS will look for when trying to instantiate a specific manager. If no manager with that name is found, KAS will attempt to use the default manager."]}),"\n",(0,r.jsx)(n.p,{children:"The basic flow is as follows:"}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"In the below example, r1 is just an example key id.\nKey managers are a part of KAS, and not external services\nalthough they can reach out to external services to perform\nneeded operations."})}),"\n",(0,r.jsx)(n.mermaid,{value:"sequenceDiagram\n    SDK->>+KAS: Rewrap key (key id=r1)\n    KAS->>+Platform: Retrieve key (key id=r1)\n    Platform->>+KAS: Returns key\n    KAS->>+KAS: Get name of provider config from key\n    KAS->>+KAS: Instantiate key manager from provider's manager field\n    KAS->>+Key Manager: Decrypt data encryption key\n    Key Manager->>+KAS: Return decrypted key\n    KAS->>+SDK: Return rewrapped data encryption key"}),"\n",(0,r.jsxs)(n.p,{children:["When creating your provider configuration and registering your key manager the ",(0,r.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/trust/key_manager.go#L50",children:"name"})," given in the manager factory, must match the ",(0,r.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/policy/keymanagement/key_management.proto#L22",children:"manager"})," field given to the provider configuration. For example, if you register a manager with name ",(0,r.jsx)(n.strong,{children:"opentdf.io/aws"})," you would need to create a provider configuration with ",(0,r.jsx)(n.strong,{children:"opentdf.io/aws"})," as the ",(0,r.jsx)(n.code,{children:"manager"})," field and tie it to a key when creating the key."]}),"\n",(0,r.jsx)(n.admonition,{type:"important",children:(0,r.jsx)(n.p,{children:"If private keys are meant to be stored within the platform database,\nthere should be no provider configuration added to the key. Since\nan empty provider configuration is assumed to be tied to the\ndefault manager."})}),"\n",(0,r.jsx)(n.admonition,{type:"important",children:(0,r.jsx)(n.p,{children:"Provider configuration names must be unique.\nYou cannot delete provider configurations that are tied to keys."})}),"\n",(0,r.jsx)(n.h2,{id:"helpful-links",children:"Helpful links"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/trust/key_manager.go#L19",children:"key manager interface"}),"."]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/trust/key_manager.go#L49-L58",children:"NamedKeyManagerFactory"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/opentdf/platform/blob/5221cf41079fc43a3966e17c6f3e0d3cf8a16730/service/trust/delegating_key_service.go#L39-L44",children:"KeyManagerFactory"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>s});var t=a(96540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);
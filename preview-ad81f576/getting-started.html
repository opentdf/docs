<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-getting-started/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Getting Started | OpenTDF</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.opentdf.io/preview-ad81f576/img/opentdf-social.png"><meta data-rh="true" name="twitter:image" content="https://docs.opentdf.io/preview-ad81f576/img/opentdf-social.png"><meta data-rh="true" property="og:url" content="https://docs.opentdf.io/preview-ad81f576/getting-started"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Getting Started | OpenTDF"><meta data-rh="true" name="description" content="{`"><meta data-rh="true" property="og:description" content="{`"><link data-rh="true" rel="icon" href="/preview-ad81f576/img/OpenTDF-Logo.png"><link data-rh="true" rel="canonical" href="https://docs.opentdf.io/preview-ad81f576/getting-started"><link data-rh="true" rel="alternate" href="https://docs.opentdf.io/preview-ad81f576/getting-started" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.opentdf.io/preview-ad81f576/getting-started" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Getting Started","item":"https://docs.opentdf.io/preview-ad81f576/getting-started"}]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","name":"OpenTDF","url":"https://opentdf.io","logo":"https://docs.opentdf.io/img/opentdf-social.png"}</script><link rel="stylesheet" href="/preview-ad81f576/assets/css/styles.52f90cbf.css">
<script src="/preview-ad81f576/assets/js/runtime~main.ed592f92.js" defer="defer"></script>
<script src="/preview-ad81f576/assets/js/main.8f8b19ec.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/preview-ad81f576/"><div class="navbar__logo"><img src="/preview-ad81f576/img/OpenTDF-Logo.png" alt="OpenTDF - Protect the Data, Build the Future" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/preview-ad81f576/img/OpenTDF-Logo.png" alt="OpenTDF - Protect the Data, Build the Future" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">OpenTDF</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/preview-ad81f576/introduction">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/opentdf" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/preview-ad81f576/"><img src="/preview-ad81f576/img/OpenTDF-Logo.png" alt="OpenTDF - Protect the Data, Build the Future" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/preview-ad81f576/img/OpenTDF-Logo.png" alt="OpenTDF - Protect the Data, Build the Future" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"><b>OpenTDF</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/preview-ad81f576/introduction">Welcome to OpenTDF Docs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" href="/preview-ad81f576/getting-started">Getting Started</a><button aria-label="Collapse sidebar category &#x27;Getting Started&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/preview-ad81f576/getting-started/configuration">Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/preview-ad81f576/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/preview-ad81f576/category/components-and-services">Components and Services</a><button aria-label="Expand sidebar category &#x27;Components and Services&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/preview-ad81f576/category/sdk">SDK</a><button aria-label="Expand sidebar category &#x27;SDK&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/preview-ad81f576/OpenAPI-clients">OpenAPI Clients</a><button aria-label="Expand sidebar category &#x27;OpenAPI Clients&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/preview-ad81f576/spec">Specification</a><button aria-label="Expand sidebar category &#x27;Specification&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/preview-ad81f576/appendix/matrix">Appendix</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/preview-ad81f576/release-notes">Release Notes</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_xLCN"><div class="docItemContainer_jfFK"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/preview-ad81f576/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Getting Started</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="row"><div class="col col--12 markdown"><style>
.download-button {
  display: inline-block;
  padding: 8px 16px;
  background-color: #0066cc;
  color: white;
  text-decoration: none;
  border-radius: 4px;
  margin-bottom: 16px;
  transition: all 0.2s ease;
}

.download-button:hover {
  background-color: #0052a3;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  color: white;
}

</style>
<header><h1>Getting Started</h1></header>
<p>This guide will walk you through setting up a new platform locally and walk you through some of the basic concepts within the OpenTDF platform.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pre-requisites">Pre-requisites<a href="#pre-requisites" class="hash-link" aria-label="Direct link to Pre-requisites" title="Direct link to Pre-requisites">​</a></h2>
<ul>
<li>A copy of the <code>otdfctl</code> CLI.<!-- -->
<ul>
<li><a href="https://github.com/opentdf/otdfctl/releases" target="_blank" rel="noopener noreferrer">Download the latest release</a></li>
</ul>
</li>
<li>A tool to run the compose file.<!-- -->
<ul>
<li><a href="https://podman.io/" target="_blank" rel="noopener noreferrer">Podman</a></li>
<li><a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">Docker Compose</a></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="update-etchosts">Update /etc/hosts<a href="#update-etchosts" class="hash-link" aria-label="Direct link to Update /etc/hosts" title="Direct link to Update /etc/hosts">​</a></h2>
<p>In order for the services to communicate correctly you will need to update your <code>/etc/hosts</code> file.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-e</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;127.0.0.1 platform.opentdf.local</span><span class="token string entity" style="color:rgb(163, 21, 21)">\n</span><span class="token string" style="color:rgb(163, 21, 21)">127.0.0.1 keycloak.opentdf.local&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">tee</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-a</span><span class="token plain"> /etc/hosts</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="getting-the-platform-running">Getting the Platform Running<a href="#getting-the-platform-running" class="hash-link" aria-label="Direct link to Getting the Platform Running" title="Direct link to Getting the Platform Running">​</a></h2>
<p>The first step is to get the platform running locally. You can use the following docker compose file to get the platform running. This docker compose file will start a local instance of the <a href="https://github.com/opentdf/platform/tree/main" target="_blank" rel="noopener noreferrer">platform</a>, <a href="https://www.keycloak.org/" target="_blank" rel="noopener noreferrer">Keycloak</a>, and a <a href="https://www.postgresql.org/" target="_blank" rel="noopener noreferrer">Postgres</a> database.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Not for production use.</p></div></div>
<a href="/quickstart/docker-compose.yaml" download="docker-compose.yaml" class="download-button">Download docker-compose.yaml</a>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Docker Compose</summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">default</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> opentdf_platform</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">caddy_config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">      {</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        log {</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">            level INFO</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">            output stdout</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">      }</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">      https://keycloak.opentdf.local:9443 {</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        tls internal</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        reverse_proxy keycloak:8888</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">      }</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">      https://platform.opentdf.local:8443 {</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        tls internal</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        reverse_proxy {</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">            to h2c://platform:8080</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">            transport http {</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">                versions h2c 2 1.1  # Enable gRPC proxying</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">            }</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">      }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">caddy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> caddy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">2.8.4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;caddy&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;run&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;--config&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;/etc/caddy/Caddyfile&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">source</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> caddy_config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">target</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /etc/caddy/Caddyfile</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;8443:8443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;9443:9443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;2019:2019&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> caddy_data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">ensure-permissions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">healthcheck</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;CMD&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;wget&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--spider&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-q&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;http://127.0.0.1:2019/metrics&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 5s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 5s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">retries</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">check-certs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> volume</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">source</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> caddy_data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">target</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /etc/ssl/certs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">volume</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">subpath</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> caddy/certificates/local/keycloak.opentdf.local/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        echo &quot;Checking certificates&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        ls -alh /etc/ssl/certs</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        cat /etc/ssl/certs/keycloak.opentdf.local.crt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">caddy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">ensure-permissions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ensure-permissions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;-c&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">      chmod -R 755 /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> caddy_data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> keycloak/keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">25.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">fix-keys-permissions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;start-dev&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--verbose&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-Djavax.net.ssl.trustStorePassword=password&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-Djavax.net.ssl.HostnameVerifier=AllowAll&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-Djavax.net.ssl.trustStore=/keys/ca.jks&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--spi-truststore-file-hostname-verification-policy=ANY&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_PROXY</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> edge</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HTTP_RELATIVE_PATH</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /auth</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HOSTNAME_STRICT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HOSTNAME_STRICT_BACKCHANNEL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HOSTNAME_STRICT_HTTPS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HTTP_ENABLED</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HTTP_PORT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;8888&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HTTPS_PORT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;8443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HTTP_MANAGEMENT_PORT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;9001&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KEYCLOAK_ADMIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> admin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KEYCLOAK_ADMIN_PASSWORD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> changeme</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">#KC_HOSTNAME_URL: http://localhost:8888/auth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_FEATURES</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;preview,token-exchange&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HEALTH_ENABLED</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HTTPS_KEY_STORE_PASSWORD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;password&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HTTPS_KEY_STORE_FILE</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/keys/ca.jks&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HTTPS_CERTIFICATE_FILE</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/keys/localhost.crt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HTTPS_CERTIFICATE_KEY_FILE</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/keys/localhost.key&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KC_HTTPS_CLIENT_AUTH</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;request&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">###</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># The following environment variable resolves SIGILL with Code 134 when running Java processes on Apple M4 chips</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># On Apple Silicon (M4 chip):</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">#   export JAVA_OPTS_APPEND=&quot;-XX:UseSVE=0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">#   docker-compose up</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># On other architectures:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">#   export JAVA_OPTS_APPEND=&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">#   docker-compose up</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># Or set directly: JAVA_OPTS_APPEND=&quot;-XX:UseSVE=0&quot; docker-compose up</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">JAVA_OPTS_APPEND</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;${JAVA_OPTS_APPEND:-}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">###</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># ports:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#   - &quot;${KC_EXPOSE_PORT:-8443}:8443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#   - &quot;${KC_EXPOSE_PORT_HTTP:-8888}:8888&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#   - &quot;${KC_EXPOSE_PORT_MGMT:-9001}:9001&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">healthcheck</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> CMD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">SHELL</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">          [ -f /tmp/HealthCheck.java ] || echo &quot;public class HealthCheck { </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">            public static void main(String[] args) throws java.lang.Throwable { </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">              javax.net.ssl.HttpsURLConnection.setDefaultHostnameVerifier((hostname, session) -&gt; true); </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">              javax.net.ssl.SSLContext sc = javax.net.ssl.SSLContext.getInstance(\&quot;SSL\&quot;); </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">              sc.init(null, new javax.net.ssl.TrustManager[]{ </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">                new javax.net.ssl.X509TrustManager() { </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">                  public java.security.cert.X509Certificate[] getAcceptedIssuers() { return null; } </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">                  public void checkClientTrusted(java.security.cert.X509Certificate[] certs, String authType) {} </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">                  public void checkServerTrusted(java.security.cert.X509Certificate[] certs, String authType) {} </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">                } </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">              }, new java.security.SecureRandom()); </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">              javax.net.ssl.HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory()); </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">              java.net.HttpURLConnection conn = (java.net.HttpURLConnection)new java.net.URL(args[0]).openConnection(); </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">              System.exit(java.net.HttpURLConnection.HTTP_OK == conn.getResponseCode() ? 0 : 1); </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">            } </span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">          }&quot; &gt; /tmp/HealthCheck.java &amp;&amp; java ${JAVA_OPTS_APPEND} /tmp/HealthCheck.java http://localhost:8888/auth 2&gt;/dev/null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 10s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 10s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">retries</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">start_period</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 3m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">opentdfdb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> postgres</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">POSTGRES_USER</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> changeme</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">POSTGRES_DB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> opentdf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">healthcheck</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">test</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;CMD-SHELL&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;pg_isready&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 5s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 5s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">retries</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">jaeger</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> jaegertracing/all</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">one</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">COLLECTOR_OTLP_ENABLED</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;16686:16686&quot;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)"># Web UI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;4317:4317&quot;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(0, 128, 0)"># OTLP gRPC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;4318:4318&quot;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(0, 128, 0)"># OTLP HTTP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;14250:14250&quot;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)"># Model/collector gRPC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">profiles</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> tracing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Provision Keycloak with initial configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">platform-provision-keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> registry.opentdf.io/platform</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">nightly</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;provision&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;keycloak&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-e&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://keycloak.opentdf.local:9443/auth&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-f&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/configs/keycloak_data.yaml&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">opentdfdb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">patch-platform-config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">download-keycloak-data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">generate-keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> OPENTDF_CONFIG_FILE=/configs/opentdf.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">extra_hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;keycloak.opentdf.local:host-gateway&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Prepare fixtures directory structure - create symlink to expected location</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">prepare-fixtures</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/configs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">download-fixtures</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        mkdir -p /configs/service/internal/fixtures</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        cd /configs</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        ln -sf /configs/service/internal/fixtures ./service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Add sample attributes and metadata  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">platform-provision-fixtures</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> registry.opentdf.io/platform</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">nightly</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;provision&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;fixtures&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--config-file&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/configs/opentdf.yaml&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">working_dir</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /configs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">platform-provision-keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">opentdfdb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">prepare-fixtures</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">generate-keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Prepare CA certificates bundle with Caddy cert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">prepare-ca-certs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> volume</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">source</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> caddy_data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">target</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /caddy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">certs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">read_only</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">volume</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">subpath</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> caddy/certificates/local/keycloak.opentdf.local</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> platform_certs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/etc/ssl/certs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">caddy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        # Install ca-certificates package</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        apk add --no-cache ca-certificates</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        # Copy Caddy certificate to CA bundle</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        cp /caddy-certs/keycloak.opentdf.local.crt /usr/local/share/ca-certificates/</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        update-ca-certificates</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        # Copy the updated CA bundle to shared volume</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        cp -r /etc/ssl/certs/* /etc/ssl/certs/</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        echo &quot;CA certificates prepared successfully&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Main OpenTDF Platform server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">platform</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> registry.opentdf.io/platform</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">nightly</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;start&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--config-file&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/configs/opentdf.yaml&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">platform-provision-fixtures</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">opentdfdb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">generate-keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">prepare-ca-certs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;8080:8080&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> platform_certs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/etc/ssl/certs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">extra_hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;keycloak.opentdf.local:host-gateway&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Initialize volume permissions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">init-volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/configs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/keys</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        chmod 777 /configs /keys</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        mkdir -p /configs/service/internal/fixtures</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        chmod -R 777 /configs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Fix keys permissions after generation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">fix-keys-permissions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/keys</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">generate-keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        chmod -R 755 /keys</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        chmod 644 /keys/*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Download platform configuration file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">download-platform-config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/configs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">init-volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;wget&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;-O&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;/configs/opentdf.yaml&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;https://raw.githubusercontent.com/opentdf/platform/main/opentdf-example.yaml&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Patch platform configuration to use keycloak.opentdf.local:9443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">patch-platform-config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/configs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">download-platform-config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        apk add --no-cache sed</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        sed -i &#x27;s|http://keycloak:8888|https://keycloak.opentdf.local:9443|g&#x27; /configs/opentdf.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        echo &quot;Patched opentdf.yaml to use keycloak.opentdf.local:9443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Download Keycloak provisioning data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">download-keycloak-data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/configs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">init-volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">entrypoint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /bin/sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        URL=&#x27;https://raw.githubusercontent.com/opentdf/platform/main/service/cmd/keycloak_data.yaml&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        OUTPUT=&#x27;/configs/keycloak_data.yaml&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        MAX_ATTEMPTS=3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        for i in $$(seq 1 $$MAX_ATTEMPTS); do</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">echo &quot;Attempt $$i of $$MAX_ATTEMPTS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Downloading keycloak_data.yaml</span><span class="token punctuation" style="color:rgb(4, 81, 165)">...</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          if wget </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">O &quot;$$OUTPUT&quot; &quot;$$URL&quot;; then</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            echo &quot;Download successful&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># Validate the downloaded file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            if </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">f &quot;$$OUTPUT&quot; </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token important">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">s &quot;$$OUTPUT&quot; </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">; then</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              if head </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">1 &quot;$$OUTPUT&quot; </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token plain"> grep </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">q </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">E &#x27;^(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token plain">\w+</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">)&#x27;; then</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">echo &quot;Validation passed</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> File exists</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> non</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">empty</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> and appears to be valid YAML&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                exit 0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              else</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">echo &quot;Validation failed</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> File does not appear to be valid YAML&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                rm </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">f &quot;$$OUTPUT&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              fi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">echo &quot;Validation failed</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> File is missing or empty&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            fi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          else</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            echo &quot;Download failed (attempt $$i)&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          fi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          if </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> $$i </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">lt $$MAX_ATTEMPTS </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">; then</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            echo &quot;Retrying in 2 seconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">...</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            sleep 2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          fi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        done</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">echo &quot;ERROR</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Failed to download and validate keycloak_data.yaml after $$MAX_ATTEMPTS attempts&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        exit 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Download fixtures data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">download-fixtures</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/configs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">init-volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;wget&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;-O&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;/configs/service/internal/fixtures/policy_fixtures.yaml&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;https://raw.githubusercontent.com/opentdf/platform/main/service/internal/fixtures/policy_fixtures.yaml&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Download init-temp-keys script</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">download-init-script</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/configs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">init-volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">entrypoint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /bin/sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        URL=&#x27;https://raw.githubusercontent.com/opentdf/platform/main/.github/scripts/init-temp-keys.sh&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        OUTPUT=&#x27;/configs/init-temp-keys.sh&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        MAX_ATTEMPTS=3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        for i in $$(seq 1 $$MAX_ATTEMPTS); do</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">echo &quot;Attempt $$i of $$MAX_ATTEMPTS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Downloading init</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">temp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">keys.sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">...</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          if wget </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">O &quot;$$OUTPUT&quot; &quot;$$URL&quot;; then</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            echo &quot;Download successful&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># Validate the downloaded file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            if </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">f &quot;$$OUTPUT&quot; </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token important">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">s &quot;$$OUTPUT&quot; </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">; then</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              if head </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">1 &quot;$$OUTPUT&quot; </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token plain"> grep </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">q &#x27;^</span><span class="token comment" style="color:rgb(0, 128, 0)">#!/&#x27;; then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">echo &quot;Validation passed</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> File exists</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> non</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">empty</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> and appears to be a shell script&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                exit 0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              else</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token key atrule">echo &quot;Validation failed</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> File does not appear to be a valid shell script&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                rm </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">f &quot;$$OUTPUT&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              fi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">echo &quot;Validation failed</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> File is missing or empty&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            fi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          else</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            echo &quot;Download failed (attempt $$i)&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          fi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          if </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> $$i </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">lt $$MAX_ATTEMPTS </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">; then</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            echo &quot;Retrying in 2 seconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">...</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            sleep 2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          fi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        done</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">echo &quot;ERROR</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Failed to download and validate init</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">temp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">keys.sh after $$MAX_ATTEMPTS attempts&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        exit 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Generate keys without Docker dependency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">generate-keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/configs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/keys</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">download-init-script</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">init-volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">entrypoint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /bin/sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        apk add --no-cache openssl openjdk11-jre bash</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">        cd /keys</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># Generate KAS RSA private key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        openssl genpkey </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">algorithm RSA </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">out /keys/kas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">private.pem </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pkeyopt rsa_keygen_bits</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">2048</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        openssl rsa </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">in /keys/kas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">private.pem </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pubout </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">out /keys/kas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">cert.pem</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># Generate ECC Key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        openssl ecparam </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">name prime256v1 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> /tmp/ecparams.tmp</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        openssl req </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">x509 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">nodes </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">newkey ec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/tmp/ecparams.tmp </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">subj &quot;/CN=kas&quot; </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">keyout /keys/kas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">private.pem </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">out /keys/kas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">cert.pem </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">days 365</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># Generate CA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        openssl req </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">x509 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">nodes </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">newkey RSA</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">2048 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">subj &quot;/CN=ca&quot; </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">keyout /keys/keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ca</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">private.pem </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">out /keys/keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ca.pem </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">days 365</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># Generate localhost certificate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        printf &quot;subjectAltName=DNS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">localhost</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">IP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">127.0.0.1&quot; </span><span class="token punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> /tmp/sanX509.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        printf &quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">req</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">\ndistinguished_name=req_distinguished_name\n</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">req_distinguished_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">\n</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">alt_names</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">\nDNS.1=localhost\nIP.1=127.0.0.1&quot; </span><span class="token punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> /tmp/req.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        openssl req </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">new </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">nodes </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">newkey rsa</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">2048 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">keyout /keys/localhost.key </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">out /tmp/localhost.req </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">batch </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">subj &quot;/CN=localhost&quot; </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">config /tmp/req.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        openssl x509 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">req </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">in /tmp/localhost.req </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">CA /keys/keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ca.pem </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">CAkey /keys/keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ca</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">private.pem </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">CAcreateserial </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">out /keys/localhost.crt </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">days 3650 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">sha256 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">extfile /tmp/sanX509.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># Generate sample user certificate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        openssl req </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">new </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">nodes </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">newkey rsa</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">2048 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">keyout /keys/sampleuser.key </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">out /tmp/sampleuser.req </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">batch </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">subj &quot;/CN=sampleuser&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        openssl x509 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">req </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">in /tmp/sampleuser.req </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">CA /keys/keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ca.pem </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">CAkey /keys/keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ca</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">private.pem </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">CAcreateserial </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">out /keys/sampleuser.crt </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">days 3650</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># Convert to PKCS12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        openssl pkcs12 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">export </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">in /keys/keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ca.pem </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">inkey /keys/keycloak</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ca</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">private.pem </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">out /keys/ca.p12 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">nodes </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">passout pass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">password</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># Convert PKCS12 to JKS using keytool (no Docker needed)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        keytool </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">importkeystore \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">srckeystore /keys/ca.p12 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">srcstoretype PKCS12 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">destkeystore /keys/ca.jks \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">deststoretype JKS \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">srcstorepass &quot;password&quot; \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">deststorepass &quot;password&quot; \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">noprompt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        echo &quot;Keys generated successfully&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">JAVA_OPTS_APPEND</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;${JAVA_OPTS_APPEND:-}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> opentdf_keys</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">configs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> opentdf_configs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">caddy_data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">platform_certs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> opentdf_platform_certs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div></div></details>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="save-the-docker-compose-file">Save the Docker Compose File<a href="#save-the-docker-compose-file" class="hash-link" aria-label="Direct link to Save the Docker Compose File" title="Direct link to Save the Docker Compose File">​</a></h3>
<p>Click the <strong>download</strong> button above to save the <code>docker-compose.yaml</code> file to your local machine. If you prefer to copy the content manually, save it as <code>docker-compose.yaml</code>.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="start-the-platform">Start the Platform<a href="#start-the-platform" class="hash-link" aria-label="Direct link to Start the Platform" title="Direct link to Start the Platform">​</a></h3>
<p>Once you have the <code>docker-compose.yaml</code> file saved, start the platform using the following command:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># If running on Apple M4 chip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">JAVA_OPTS_APPEND</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-XX:UseSVE=0&quot;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> compose </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--file</span><span class="token plain"> docker-compose.yaml up </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Or on other architectures</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> compose </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--file</span><span class="token plain"> docker-compose.yaml up </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-d</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>Note for Apple M4 chip users:</strong><br>
<!-- -->The <code>JAVA_OPTS_APPEND=&quot;-XX:UseSVE=0&quot;</code> environment variable resolves SIGILL with Code 134 errors when running Java processes (such as Keycloak).</p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="trust-self-signed-certificates">Trust Self Signed Certificates<a href="#trust-self-signed-certificates" class="hash-link" aria-label="Direct link to Trust Self Signed Certificates" title="Direct link to Trust Self Signed Certificates">​</a></h2>
<p>After starting the platform, <code>caddy</code> will generate self-signed certificates during the bootstrapping process. You will either need to trust these certificates on your system or use the <code>--tls-no-verify</code> flag on every command. If using the <code>--tls-no-verify</code> command it will disable profiles and require that you pass in the host and authentication into each command.</p>
<p>First, extract the certificates from the container:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-p</span><span class="token plain"> ./opentdf-certs</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> compose </span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> caddy:/data/caddy/certificates/local/keycloak.opentdf.local/keycloak.opentdf.local.crt ./opentdf-certs</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> compose </span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> caddy:/data/caddy/certificates/local/platform.opentdf.local/platform.opentdf.local.crt ./opentdf-certs</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="import-and-trust-certificates-by-operating-system">Import and Trust Certificates by Operating System<a href="#import-and-trust-certificates-by-operating-system" class="hash-link" aria-label="Direct link to Import and Trust Certificates by Operating System" title="Direct link to Import and Trust Certificates by Operating System">​</a></h3>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>macOS</strong></summary><div><div class="collapsibleContent_i85q"><ol>
<li>
<p><strong>Import certificates to Keychain:</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Import both certificates to the System keychain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> security add-trusted-cert </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-d</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-r</span><span class="token plain"> trustRoot </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-k</span><span class="token plain"> /Library/Keychains/System.keychain ./opentdf-certs/keycloak.opentdf.local.crt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> security add-trusted-cert </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-d</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-r</span><span class="token plain"> trustRoot </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-k</span><span class="token plain"> /Library/Keychains/System.keychain ./opentdf-certs/platform.opentdf.local.crt</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Alternative: Using Keychain Access GUI:</strong></p>
<ul>
<li>Open <strong>Keychain Access</strong> (Applications → Utilities → Keychain Access)</li>
<li>Drag and drop both <code>.crt</code> files into the <strong>System</strong> keychain</li>
<li>Double-click each certificate and set <strong>Trust</strong> → <strong>When using this certificate</strong> to <strong>Always Trust</strong></li>
<li>Enter your admin password when prompted</li>
</ul>
</li>
<li>
<p><strong>Verify certificates are trusted:</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">security verify-cert </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-c</span><span class="token plain"> ./opentdf-certs/keycloak.opentdf.local.crt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">security verify-cert </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-c</span><span class="token plain"> ./opentdf-certs/platform.opentdf.local.crt</span><br></span></code></pre></div></div>
</li>
</ol><p><strong>References:</strong></p><ul>
<li><a href="https://support.apple.com/guide/keychain-access/add-certificates-to-a-keychain-kyca2431/mac" target="_blank" rel="noopener noreferrer">Add certificates to a keychain</a></li>
<li><a href="https://support.apple.com/guide/keychain-access/change-the-trust-settings-of-a-certificate-kyca11871/mac" target="_blank" rel="noopener noreferrer">Change trust settings of a certificate</a></li>
</ul></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Windows</strong></summary><div><div class="collapsibleContent_i85q"><ol>
<li>
<p><strong>Import certificates using PowerShell (Run as Administrator):</strong></p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># Import to Trusted Root Certification Authorities</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Import-Certificate -FilePath &quot;.\opentdf-certs\keycloak.opentdf.local.crt&quot; -CertStoreLocation Cert:\LocalMachine\Root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Import-Certificate -FilePath &quot;.\opentdf-certs\platform.opentdf.local.crt&quot; -CertStoreLocation Cert:\LocalMachine\Root</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Alternative: Using Certificate Manager GUI:</strong></p>
<ul>
<li>Press <code>Win + R</code>, type <code>certmgr.msc</code>, and press Enter</li>
<li>Navigate to <strong>Trusted Root Certification Authorities</strong> → <strong>Certificates</strong></li>
<li>Right-click and select <strong>All Tasks</strong> → <strong>Import</strong></li>
<li>Follow the wizard to import both <code>.crt</code> files</li>
<li>Choose <strong>Place all certificates in the following store</strong> → <strong>Trusted Root Certification Authorities</strong></li>
</ul>
</li>
<li>
<p><strong>Alternative: Using MMC (Microsoft Management Console):</strong></p>
<ul>
<li>Press <code>Win + R</code>, type <code>mmc</code>, and press Enter</li>
<li>Go to <strong>File</strong> → <strong>Add/Remove Snap-in</strong></li>
<li>Add <strong>Certificates</strong> snap-in for <strong>Local Computer</strong></li>
<li>Navigate to <strong>Certificates (Local Computer)</strong> → <strong>Trusted Root Certification Authorities</strong> → <strong>Certificates</strong></li>
<li>Right-click and import both certificates</li>
</ul>
</li>
</ol></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Linux (Ubuntu/Debian)</strong></summary><div><div class="collapsibleContent_i85q"><ol>
<li>
<p><strong>Copy certificates to system certificate directory:</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Copy certificates to the ca-certificates directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> ./opentdf-certs/keycloak.opentdf.local.crt /usr/local/share/ca-certificates/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> ./opentdf-certs/platform.opentdf.local.crt /usr/local/share/ca-certificates/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Update the certificate store</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> update-ca-certificates</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Verify certificates are installed:</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Check if certificates are in the trusted store</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-v</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">cmd</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;openssl x509 -noout -subject&#x27;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;/BEGIN/{close(cmd)};{print | cmd}&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> /etc/ssl/certs/ca-certificates.crt </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> opentdf</span><br></span></code></pre></div></div>
</li>
</ol></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Linux (RHEL/CentOS/Fedora)</strong></summary><div><div class="collapsibleContent_i85q"><ol>
<li>
<p><strong>Copy certificates to system certificate directory:</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Copy certificates to the ca-trust directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> ./opentdf-certs/keycloak.opentdf.local.crt /etc/pki/ca-trust/source/anchors/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> ./opentdf-certs/platform.opentdf.local.crt /etc/pki/ca-trust/source/anchors/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Update the certificate store</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> update-ca-trust</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Verify certificates are installed:</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Check if certificates are trusted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">trust list </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;opentdf.local&quot;</span><br></span></code></pre></div></div>
</li>
</ol></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Linux (Arch Linux)</strong></summary><div><div class="collapsibleContent_i85q"><ol>
<li><strong>Copy certificates to system certificate directory:</strong>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Copy certificates to the ca-certificates directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> ./opentdf-certs/keycloak.opentdf.local.crt /etc/ca-certificates/trust-source/anchors/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> ./opentdf-certs/platform.opentdf.local.crt /etc/ca-certificates/trust-source/anchors/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Update the certificate store</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> trust extract-compat</span><br></span></code></pre></div></div>
</li>
</ol></div></div></details>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Browser-specific Certificate Installation</div><div class="admonitionContent_BuS1"><p>Some browsers (like Firefox) maintain their own certificate stores. If you continue to see certificate warnings in your browser after following the OS-specific steps above, you may need to import the certificates directly into your browser&#x27;s certificate store.</p></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Certificate Validity</div><div class="admonitionContent_BuS1"><p>These self-signed certificates are only valid for local development. Never use self-signed certificates in production environments.</p></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-a-profile">Create a Profile<a href="#create-a-profile" class="hash-link" aria-label="Direct link to Create a Profile" title="Direct link to Create a Profile">​</a></h2>
<p>Creating a profile allows us to store the host we want to connect to and then to tie our credentials to it when we login.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl profile create platform-otdf-local https://platform.opentdf.local:8443</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="login-to-the-platform">Login to the Platform<a href="#login-to-the-platform" class="hash-link" aria-label="Direct link to Login to the Platform" title="Direct link to Login to the Platform">​</a></h2>
<p>During the provisioning of the platform, a few test clients were created in <strong>Keycloak</strong>. You can use the following credentials to login to the platform. This will cache those credentials locally for the <code>otdfctl</code> CLI. You can also pass in the flags <code>--with-client-creds</code> and <code>--with-client-creds-file</code> on every command to authenticate with the platform.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local auth client-credentials opentdf secret</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-a-namespace">Create A Namespace<a href="#create-a-namespace" class="hash-link" aria-label="Direct link to Create A Namespace" title="Direct link to Create A Namespace">​</a></h2>
<p>In this first step you are going to create a new <code>namespace</code>. A namespace is a way to organize your <code>attributes</code> within the platform.</p>
<p>You will see an empty list of namespaces when you first start the platform.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local policy attributes namespaces list</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SUCCESS   Found namespaces list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">┌─────────────────────────┬───────────────────────────┬─────────────────────────────┬────────────────────────────┬────────────────────────────────┬────────────────────────────────┐</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Id                       │Name                       │Active                       │Labels                      │Created At                      │Updated At                      │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├─────────────────────────┼───────────────────────────┼─────────────────────────────┼────────────────────────────┼────────────────────────────────┼────────────────────────────────┤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└─────────────────────────┴───────────────────────────┴─────────────────────────────┴────────────────────────────┴────────────────────────────────┴────────────────────────────────┘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTE   Use </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;namespaces get --id=&lt;id&gt; --json&#x27;</span><span class="token plain"> to see all properties</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-a-new-namespace">Create a new namespace<a href="#create-a-new-namespace" class="hash-link" aria-label="Direct link to Create a new namespace" title="Direct link to Create a new namespace">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local policy attributes namespaces create </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--name</span><span class="token plain"> opentdf.io</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SUCCESS   Created namespaces: 7650f02a-be00-4faa-a1d1-37cded5e23dc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">┌────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Property                                                                    │Value                                                                                                │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Name                                                                        │opentdf.io                                                                                           │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Id                                                                          │7650f02a-be00-4faa-a1d1-37cded5e23dc                                                                 │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Created At                                                                  │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:02:00 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                         │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Updated At                                                                  │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:02:00 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                         │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTE   Use </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;namespaces get --id=7650f02a-be00-4faa-a1d1-37cded5e23dc --json&#x27;</span><span class="token plain"> to see all properties</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="list-the-namespaces">List the namespaces<a href="#list-the-namespaces" class="hash-link" aria-label="Direct link to List the namespaces" title="Direct link to List the namespaces">​</a></h3>
<p>With that namespace created we should be able to see it in the list of namespaces as well as get the details of the namespace.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local policy attributes namespaces list</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SUCCESS   Found namespaces list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">┌──────────────────────────────────────────────┬────────────────────┬────────────────┬────────────────┬──────────────────────────────────────┬─────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Id                                            │Name                │Active          │Labels          │Created At                            │Updated At                           │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├──────────────────────────────────────────────┼────────────────────┼────────────────┼────────────────┼──────────────────────────────────────┼─────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│7650f02a-be00-4faa-a1d1-37cded5e23dc          │opentdf.io          │true            │</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">              │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:02:00 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">          │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:02:00 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">         │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└──────────────────────────────────────────────┴────────────────────┴────────────────┴────────────────┴──────────────────────────────────────┴─────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTE   Use </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;namespaces get --id=&lt;id&gt; --json&#x27;</span><span class="token plain"> to see all properties</span><br></span></code></pre></div></div>
<p>Let&#x27;s export the namespace id for later use.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">NAMESPACE_ID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">id</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="get-the-details-of-the-namespace">Get the details of the namespace<a href="#get-the-details-of-the-namespace" class="hash-link" aria-label="Direct link to Get the details of the namespace" title="Direct link to Get the details of the namespace">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local policy attributes namespaces get </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--id</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$NAMESPACE_ID</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SUCCESS   Found namespaces: 7650f02a-be00-4faa-a1d1-37cded5e23dc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">┌────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Property                                                                    │Value                                                                                                │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├────────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────────────  ───────────────────┤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Id                                                                          │7650f02a-be00-4faa-a1d1-37cded5e23dc                                                                 │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Name                                                                        │opentdf.io                                                                                           │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Created At                                                                  │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:02:00 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                         │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Updated At                                                                  │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:02:00 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                         │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└────────────────────────────────────────────────────────────────── ──────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTE   Use </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;namespaces get --id=7650f02a-be00-4faa-a1d1-37cded5e23dc --json&#x27;</span><span class="token plain"> to see all properties</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-an-attribute">Create an Attribute<a href="#create-an-attribute" class="hash-link" aria-label="Direct link to Create an Attribute" title="Direct link to Create an Attribute">​</a></h2>
<p>Now that we have a namespace we can create a new attribute. An attribute is a way to define a classification for your data.</p>
<p>It consists of two main parts:</p>
<ol>
<li>
<p>A <code>definition</code> which describes how an entities entitlements and resource attributes are compared.</p>
<ol>
<li><strong>ANY_OF</strong>: The entity must have at least one of the values in the list. This is your typical <code>OR</code> operation.</li>
<li><strong>ALL_OF</strong>: The entity must have all of the values in the list. This is your typical <code>AND</code> operation.</li>
<li><strong>HIERARCHY</strong>: This is an ordered list of values. The entity must have an equal or greater value in the list.</li>
</ol>
</li>
<li>
<p>A list of <code>values</code></p>
</li>
</ol>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Attribute name and values are case insensitive. This means <code>ROLE</code> is equal to <code>role</code>.</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>You can also create values at the same time when creating the definition. This is useful when you know the values you want to use. (e.g. --value admin --value developer --value guest)</p></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-attribute-definition">Create attribute definition<a href="#create-attribute-definition" class="hash-link" aria-label="Direct link to Create attribute definition" title="Direct link to Create attribute definition">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local policy attributes create </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--name</span><span class="token plain"> role  </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-s</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$NAMESPACE_ID</span><span class="token plain">  </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-r</span><span class="token plain"> ANY_OF</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SUCCESS   Created attributes: bd02d7ab-564d-4b6c-95c4-3d4a8a259000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">┌────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Property                                                                        │Value                                                                                            │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├────────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Name                                                                            │role                                                                                             │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Rule                                                                            │ANY_OF                                                                                           │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Values                                                                          │</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                                                                                               │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Namespace                                                                       │opentdf.io                                                                                       │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Created At                                                                      │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:09:39 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                     │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Updated At                                                                      │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:09:39 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                     │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTE   Use </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;attributes get --id=bd02d7ab-564d-4b6c-95c4-3d4a8a259000 --json&#x27;</span><span class="token plain"> to see all properties</span><br></span></code></pre></div></div>
<p>Let&#x27;s export the attribute id for later use.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ATTRIBUTE_ID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">id</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-attribute-values">Create attribute values<a href="#create-attribute-values" class="hash-link" aria-label="Direct link to Create attribute values" title="Direct link to Create attribute values">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Create admin value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local policy attributes values create </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-a</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$ATTRIBUTE_ID</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--value</span><span class="token plain"> admin</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SUCCESS   Created values: 0fe7e8d0-a3ff-485f-ac24-a54d85904712</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">┌──────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Property                                                                  │Value                                                                                                  │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├──────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────── ────────────────────────────┤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Id                                                                        │0fe7e8d0-a3ff-485f-ac24-a54d85904712                                                                   │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│FQN                                                                       │https://opentdf.io/attr/role/value/admin                                                               │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Value                                                                     │admin                                                                                                  │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Created At                                                                │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:11:15 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                           │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Updated At                                                                │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:11:15 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                           │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└──────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTE   Use </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;values get --id=0fe7e8d0-a3ff-485f-ac24-a54d85904712 --json&#x27;</span><span class="token plain"> to see all properties</span><br></span></code></pre></div></div>
<p>Export the admin value id for later use.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ADMIN_VALUE_ID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">id</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Create developer value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local policy attributes values create </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-a</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$ATTRIBUTE_ID</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--value</span><span class="token plain"> developer</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SUCCESS   Created values: dbfcbe15-7392-4e35-9e1d-3d06918472be</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">┌────────────────────────────────────────────────────────────────────────┬────────────────────────────────────────────────────────────────────────────────────────── ───────────────┐</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Property                                                                │Value                                                                                                    │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Id                                                                      │dbfcbe15-7392-4e35-9e1d-3d06918472be                                                                     │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│FQN                                                                     │https://opentdf.io/attr/role/value/developer                                                             │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Value                                                                   │developer                                                                                                │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Created At                                                              │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:12:45 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                             │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Updated At                                                              │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:12:45 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                             │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTE   Use </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;values get --id=dbfcbe15-7392-4e35-9e1d-3d06918472be --json&#x27;</span><span class="token plain"> to see all properties</span><br></span></code></pre></div></div>
<p>Export the developer value id for later use.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">DEVELOPER_VALUE_ID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">id</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Create guest value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local policy attributes values create </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-a</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$ATTRIBUTE_ID</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--value</span><span class="token plain"> guest</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SUCCESS   Created values: 654f0877-2c0b-4a62-a9c3-87ed42bf77ac</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">┌──────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Property                                                                  │Value                                                                                                  │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├──────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Id                                                                        │654f0877-2c0b-4a62-a9c3-87ed42bf77ac                                                                   │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│FQN                                                                       │https://opentdf.io/attr/role/value/guest                                                               │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Value                                                                     │guest                                                                                                  │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Created At                                                                │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:14:22 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                           │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Updated At                                                                │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:14:22 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                           │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└──────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTE   Use </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;values get --id=654f0877-2c0b-4a62-a9c3-87ed42bf77ac --json&#x27;</span><span class="token plain"> to see all properties</span><br></span></code></pre></div></div>
<p>Export the guest value id for later use.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">GUEST_VALUE_ID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">id</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="get-the-attribute-details">Get the attribute details<a href="#get-the-attribute-details" class="hash-link" aria-label="Direct link to Get the attribute details" title="Direct link to Get the attribute details">​</a></h3>
<p>Now that we have listed values for the attribute, we can get the details of the attribute. You should see the added values in the list now.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local policy attributes get </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--id</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$ATTRIBUTE_ID</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SUCCESS   Found attributes: bd02d7ab-564d-4b6c-95c4-3d4a8a259000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">┌────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Property                                                                    │Value                                                                                                │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Id                                                                          │bd02d7ab-564d-4b6c-95c4-3d4a8a259000                                                                 │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Name                                                                        │role                                                                                                 │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Rule                                                                        │ANY_OF                                                                                               │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Values                                                                      │</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">admin, developer, guest</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                                                                            │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Namespace                                                                   │opentdf.io                                                                                           │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Created At                                                                  │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:09:39 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                         │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Updated At                                                                  │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:14:22 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                         │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└────────────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────────────────────── ─────────┘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTE   Use </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;attributes get --id=bd02d7ab-564d-4b6c-95c4-3d4a8a259000 --json&#x27;</span><span class="token plain"> to see all properties</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-a-subject-mapping">Create a Subject Mapping<a href="#create-a-subject-mapping" class="hash-link" aria-label="Direct link to Create a Subject Mapping" title="Direct link to Create a Subject Mapping">​</a></h2>
<p>A <code>subject mapping</code> is a way to define how a user or entity is mapped to an attribute in the <strong>OpenTDF Platform</strong>.</p>
<p>An attribute that is mapped to an entity is considered an <code>entitlement</code>. An <code>entitlement</code> is a way to define what tdf resources an entity can access.</p>
<p>With <code>subject mappings</code> there is a sub-resource  called <code>subject condition sets</code>. These are a set of conditions that must be met for the <code>subject mapping</code> to be applied.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-a-subject-condition-set">Create a Subject Condition Set<a href="#create-a-subject-condition-set" class="hash-link" aria-label="Direct link to Create a Subject Condition Set" title="Direct link to Create a Subject Condition Set">​</a></h3>
<p>Download the <a target="_blank" href="/quickstart/subject_condition_set.json" download="subject_condition_set.json">example</a> subject condition set. You can use this file to create a new condition set.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"> otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local policy subject-condition-sets create </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-j</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">path to file</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">/subject_condition_set.json</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SUCCESS   Created subject-condition-sets: 74bf521f-5a79-48fe-acb8-b4b63ee7950b</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">┌──────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Property      │Value                                                                                                                                                              │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├──────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Id            │74bf521f-5a79-48fe-acb8-b4b63ee7950b                                                                                                                               │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│SubjectSets   │</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;condition_groups&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;conditions&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;subject_external_selector_value&quot;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;.clientId&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;operator&quot;</span><span class="token plain">:1,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;subject_external_values&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;opentdf&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;boolean_operator&quot;</span><span class="token plain">:1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">  │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Created At    │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:33:28 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                                                                                       │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Updated At    │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:33:28 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                                                                                       │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└──────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTE   Use </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;subject-condition-sets get --id=74bf521f-5a79-48fe-acb8-b4b63ee7950b --json&#x27;</span><span class="token plain"> to see all properties</span><br></span></code></pre></div></div>
<p>Let&#x27;s export the subject condition set id for later use.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">SUBJECT_CONDITION_SET_ID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">id</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-a-subject-mapping-1">Create a Subject Mapping<a href="#create-a-subject-mapping-1" class="hash-link" aria-label="Direct link to Create a Subject Mapping" title="Direct link to Create a Subject Mapping">​</a></h3>
<p>With the condition set created we can now create a new subject mapping that is tied to the subject condition set.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local policy subject-mappings create </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--action</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> --attribute-value-id </span><span class="token variable" style="color:rgb(9, 134, 88)">$DEVELOPER_VALUE_ID</span><span class="token plain"> --subject-condition-set-id </span><span class="token variable" style="color:rgb(9, 134, 88)">$SUBJECT_CONDITION_SET_ID</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SUCCESS   Created subject-mappings: 751054f8-14da-44c0-9341-5dab36b8256d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">┌─────────────────────────┬────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Property                 │Value                                                                                                                                                   │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├─────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Id                       │751054f8-14da-44c0-9341-5dab36b8256d                                                                                                                    │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Subject AttrVal: Id      │dbfcbe15-7392-4e35-9e1d-3d06918472be                                                                                                                    │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Actions                  │</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Value&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Standard&quot;</span><span class="token plain">:1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                                                                                                                              │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Subject Condition Set: I…│74bf521f-5a79-48fe-acb8-b4b63ee7950b                                                                                                                    │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Subject Condition Set    │</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;condition_groups&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;conditions&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;subject_external_selector_value&quot;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;.clientId&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;operator&quot;</span><span class="token plain">:1,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;subject_external_values&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;opentdf&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">,&quot;boolean_opera…│</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Attribute Value Id       │dbfcbe15-7392-4e35-9e1d-3d06918472be                                                                                                                    │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Created At               │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:35:13 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                                                                            │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Updated At               │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:35:13 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                                                                            │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└─────────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTE   Use </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;subject-mappings get --id=751054f8-14da-44c0-9341-5dab36b8256d --json&#x27;</span><span class="token plain"> to see all properties</span><br></span></code></pre></div></div>
<p>Let&#x27;s export the subject mapping id for later use.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">SUBJECT_MAPPING_ID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">id</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="encrypt-some-data-with-tdf">Encrypt Some Data With TDF<a href="#encrypt-some-data-with-tdf" class="hash-link" aria-label="Direct link to Encrypt Some Data With TDF" title="Direct link to Encrypt Some Data With TDF">​</a></h2>
<p>Now that we have a few basic resources in place we can show you how to control access to data using the <strong>OpenTDF Platform</strong>.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="encrypt-data-without-attributes">Encrypt Data Without Attributes<a href="#encrypt-data-without-attributes" class="hash-link" aria-label="Direct link to Encrypt Data Without Attributes" title="Direct link to Encrypt Data Without Attributes">​</a></h3>
<p>Within the <code>otdfctl</code> CLI there is basic functionality to interact with <code>zTDF</code>.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="example-ztdf-encryption">Example zTDF encryption<a href="#example-ztdf-encryption" class="hash-link" aria-label="Direct link to Example zTDF encryption" title="Direct link to Example zTDF encryption">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;my first encrypted tdf&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> otdfctl encrypt </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-o</span><span class="token plain"> example.tdf --tdf-type tdf3</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="decrypt-data-without-attributes">Decrypt Data Without Attributes<a href="#decrypt-data-without-attributes" class="hash-link" aria-label="Direct link to Decrypt Data Without Attributes" title="Direct link to Decrypt Data Without Attributes">​</a></h3>
<p>Because we didn&#x27;t add any attributes to the data we encrypted, we should be able to decrypt the data without any issues.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl decrypt </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local --tdf-type tdf3 example.tdf</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">my first encrypted tdf</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="encrypt-data-with-attributes">Encrypt Data With Attributes<a href="#encrypt-data-with-attributes" class="hash-link" aria-label="Direct link to Encrypt Data With Attributes" title="Direct link to Encrypt Data With Attributes">​</a></h3>
<p>In this example we will encrypt the data with the attribute <code>https://opentdf.io/attr/role/value/guest</code>. First cleanup any existing tdf files from before.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">rm</span><span class="token plain"> example.tdf</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="example-ztdf-encryption-with-attributes">Example zTDF encryption with attributes<a href="#example-ztdf-encryption-with-attributes" class="hash-link" aria-label="Direct link to Example zTDF encryption with attributes" title="Direct link to Example zTDF encryption with attributes">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;my first encrypted tdf&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> otdfctl encrypt </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-o</span><span class="token plain"> example.tdf --tdf-type tdf3 </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--attr</span><span class="token plain"> https://opentdf.io/attr/role/value/guest</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="decrypt-data-with-attributes">Decrypt Data With Attributes<a href="#decrypt-data-with-attributes" class="hash-link" aria-label="Direct link to Decrypt Data With Attributes" title="Direct link to Decrypt Data With Attributes">​</a></h3>
<p>In this first example we will try to decrypt the data but it will fail because we shouldn&#x27;t be assigned the entitlement of <code>https://opentdf.io/attr/role/value/guest</code> at this point.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="example-ztdf-failed-decryption">Example zTDF failed decryption<a href="#example-ztdf-failed-decryption" class="hash-link" aria-label="Direct link to Example zTDF failed decryption" title="Direct link to Example zTDF failed decryption">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl decrypt </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local --tdf-type tdf3 example.tdf</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ERROR    Failed to decrypt file: reader.WriteTo failed: doPayloadKeyUnwrap splitKey.rewrap failed: error making request to kas: error making rewrap request: rpc error: code </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> PermissionDenied desc </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> request error</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            rpc error: code </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> PermissionDenied desc </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> forbidden</span><br></span></code></pre></div></div>
<p>What we have to do now is assign the entitlement of <code>https://opentdf.io/attr/role/value/guest</code> to the entity by creating a new subject mapping for the condition set we created earlier.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-a-new-subject-mapping">Create a new subject mapping<a href="#create-a-new-subject-mapping" class="hash-link" aria-label="Direct link to Create a new subject mapping" title="Direct link to Create a new subject mapping">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local policy subject-mappings create </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--action</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> --attribute-value-id </span><span class="token variable" style="color:rgb(9, 134, 88)">$GUEST_VALUE_ID</span><span class="token plain"> --subject-condition-set-id </span><span class="token variable" style="color:rgb(9, 134, 88)">$SUBJECT_CONDITION_SET_ID</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SUCCESS   Created subject-mappings: f6bf9fc7-e23b-4276-9dfc-7a61f359edfd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">┌─────────────────────────┬────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Property                 │Value                                                                                                                                                   │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├─────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Id                       │f6bf9fc7-e23b-4276-9dfc-7a61f359edfd                                                                                                                    │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Subject AttrVal: Id      │654f0877-2c0b-4a62-a9c3-87ed42bf77ac                                                                                                                    │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Actions                  │</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Value&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Standard&quot;</span><span class="token plain">:1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                                                                                                                              │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Subject Condition Set: I…│74bf521f-5a79-48fe-acb8-b4b63ee7950b                                                                                                                    │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Subject Condition Set    │</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;condition_groups&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;conditions&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;subject_external_selector_value&quot;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;.clientId&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;operator&quot;</span><span class="token plain">:1,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;subject_external_values&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;opentdf&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">,&quot;boolean_opera…│</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Attribute Value Id       │654f0877-2c0b-4a62-a9c3-87ed42bf77ac                                                                                                                    │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Created At               │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain">:28:22 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                                                                            │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│Updated At               │Mon Jun </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain">:28:22 UTC </span><span class="token number" style="color:rgb(9, 134, 88)">2024</span><span class="token plain">                                                                                                                            │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└─────────────────────────┴───────────────────────────────────────────────────────────────────────────────────────  ─────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTE   Use </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;subject-mappings get --id=f6bf9fc7-e23b-4276-9dfc-7a61f359edfd --json&#x27;</span><span class="token plain"> to see all properties</span><br></span></code></pre></div></div>
<p>Now that we have the subject mapping in place we should be able to decrypt the data.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="example-ztdf-successful-decryption">Example zTDF successful decryption<a href="#example-ztdf-successful-decryption" class="hash-link" aria-label="Direct link to Example zTDF successful decryption" title="Direct link to Example zTDF successful decryption">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">otdfctl decrypt </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--profile</span><span class="token plain"> platform-otdf-local --tdf-type tdf3 example.tdf</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">my first encrypted tdf</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="takeaways-and-next-steps">Takeaways and Next Steps<a href="#takeaways-and-next-steps" class="hash-link" aria-label="Direct link to Takeaways and Next Steps" title="Direct link to Takeaways and Next Steps">​</a></h2>
<p>In this document you have learned how to create a namespace, attribute, subject mapping, and encrypt/decrypt data with the <strong>OpenTDF Platform</strong>.</p></div></div></div><div class="row"><div class="col col--12"></div></div></article><div class="row"><div class="col col--12"><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/preview-ad81f576/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Welcome to OpenTDF Docs</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/preview-ad81f576/getting-started/configuration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configuration</div></a></nav></div></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#pre-requisites" class="table-of-contents__link toc-highlight">Pre-requisites</a></li><li><a href="#update-etchosts" class="table-of-contents__link toc-highlight">Update /etc/hosts</a></li><li><a href="#getting-the-platform-running" class="table-of-contents__link toc-highlight">Getting the Platform Running</a><ul><li><a href="#save-the-docker-compose-file" class="table-of-contents__link toc-highlight">Save the Docker Compose File</a></li><li><a href="#start-the-platform" class="table-of-contents__link toc-highlight">Start the Platform</a></li></ul></li><li><a href="#trust-self-signed-certificates" class="table-of-contents__link toc-highlight">Trust Self Signed Certificates</a><ul><li><a href="#import-and-trust-certificates-by-operating-system" class="table-of-contents__link toc-highlight">Import and Trust Certificates by Operating System</a></li></ul></li><li><a href="#create-a-profile" class="table-of-contents__link toc-highlight">Create a Profile</a></li><li><a href="#login-to-the-platform" class="table-of-contents__link toc-highlight">Login to the Platform</a></li><li><a href="#create-a-namespace" class="table-of-contents__link toc-highlight">Create A Namespace</a><ul><li><a href="#create-a-new-namespace" class="table-of-contents__link toc-highlight">Create a new namespace</a></li><li><a href="#list-the-namespaces" class="table-of-contents__link toc-highlight">List the namespaces</a></li><li><a href="#get-the-details-of-the-namespace" class="table-of-contents__link toc-highlight">Get the details of the namespace</a></li></ul></li><li><a href="#create-an-attribute" class="table-of-contents__link toc-highlight">Create an Attribute</a><ul><li><a href="#create-attribute-definition" class="table-of-contents__link toc-highlight">Create attribute definition</a></li><li><a href="#create-attribute-values" class="table-of-contents__link toc-highlight">Create attribute values</a></li><li><a href="#get-the-attribute-details" class="table-of-contents__link toc-highlight">Get the attribute details</a></li></ul></li><li><a href="#create-a-subject-mapping" class="table-of-contents__link toc-highlight">Create a Subject Mapping</a><ul><li><a href="#create-a-subject-condition-set" class="table-of-contents__link toc-highlight">Create a Subject Condition Set</a></li><li><a href="#create-a-subject-mapping-1" class="table-of-contents__link toc-highlight">Create a Subject Mapping</a></li></ul></li><li><a href="#encrypt-some-data-with-tdf" class="table-of-contents__link toc-highlight">Encrypt Some Data With TDF</a><ul><li><a href="#encrypt-data-without-attributes" class="table-of-contents__link toc-highlight">Encrypt Data Without Attributes</a></li><li><a href="#decrypt-data-without-attributes" class="table-of-contents__link toc-highlight">Decrypt Data Without Attributes</a></li><li><a href="#encrypt-data-with-attributes" class="table-of-contents__link toc-highlight">Encrypt Data With Attributes</a></li><li><a href="#decrypt-data-with-attributes" class="table-of-contents__link toc-highlight">Decrypt Data With Attributes</a></li></ul></li><li><a href="#takeaways-and-next-steps" class="table-of-contents__link toc-highlight">Takeaways and Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Sponsors</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://virtru.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Virtru<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Support</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/preview-ad81f576/getting-started/configuration">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/preview-ad81f576/introduction">Documentation</a></li><li class="footer__item"><a href="https://github.com/orgs/opentdf/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/orgs/opentdf/discussions/categories/show-and-tell" target="_blank" rel="noopener noreferrer" class="footer__link-item">Showcase<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/orgs/opentdf/discussions/1806" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roadmap<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/preview-ad81f576/privacy-policy">Privacy Policy</a></li><li class="footer__item"><a class="footer__link-item" href="/preview-ad81f576/cookie-policy">Cookie Policy</a></li><li class="footer__item"><a class="footer__link-item" href="/preview-ad81f576/terms-of-service">Terms of Service</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opentdf.io" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/preview-ad81f576/img/opentdf-logo-horizontal.png" alt="OpenTDF Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/preview-ad81f576/img/opentdf-logo-horizontal.png" alt="OpenTDF Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">
          <span>Copyright © 2026 OpenTDF</span>
          <iconify-icon data-icon="mdi:shield-check" style="color: #00FF00;"></iconify-icon>
        </div></div></div></footer></div>
</body>
</html>
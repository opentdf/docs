---
title: Quickstart
slug: /quickstart
sidebar_label: Quickstart
unlisted: true
---

import dockerComposeContent from '!!raw-loader!./docker-compose.yaml';
import CodeBlock from '@theme/CodeBlock';

<style>
{`
.download-button {
  display: inline-block;
  padding: 8px 16px;
  background-color: #0066cc;
  color: white;
  text-decoration: none;
  border-radius: 4px;
  margin-bottom: 16px;
  transition: all 0.2s ease;
}

.download-button:hover {
  background-color: #0052a3;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  color: white;
}

`}
</style>

# Getting Started

This guide will walk you through encrypting and decrypting data using OpenTDF tools. We'll help you set up a sandbox [OpenTDF platform](/architecture) locally with attribute based access controls (ABAC) to demonstrate the basic concepts of OpenTDF.

## The Scenario

Let's follow a real-world example: Jen Moneybanks, CFO at a company, creates a highly sensitive financial strategy document for next year. Preston Price (an accountant) and Jack Vascript (an engineer) both try to access it, but are denied.

Recognizing the need for wider collaboration, Jen creates a derivative version that removes executive-only details but keeps relevant financial information. Now Preston can access the derivative document, while Jack remains locked out.

We'll use OpenTDF to implement this exact scenario with:
- **Departments**: `finance`, `engineering`
- **Clearance levels**: `executive`, `standard`
- **Two documents**: Executive strategy (requires executive clearance) and derivative report (requires finance department access)

## Pre-requisites
- macOS, Linux, or Windows (WSL2)
- [Docker Desktop](https://docs.docker.com/desktop/) or Docker Engine installed and running
- 4GB+ RAM available
- 10GB+ free disk space

## Getting the Platform Running

The OpenTDF Platform is the core service that enforces attribute-based access control for encrypted data. It handles:
- Defining and managing attributes (like department, clearance level)
- Enforcing access policies when data is encrypted or decrypted
- Managing cryptographic keys through the Key Access Server (KAS)
- Validating user entitlements before granting access to data

We'll run a local instance using Docker. This includes the [Platform](https://github.com/opentdf/platform/tree/main), [Keycloak](https://www.keycloak.org/) (for user authentication), and [PostgreSQL](https://www.postgresql.org/) (for storing attributes and policies).

:::warning
Not for production use.
:::

### Run Pre-flight Check (Optional)

Verify your system meets the requirements:

```shell
curl -fsSL https://opentdf.io/check.sh | bash
```

Or download and run locally:
```shell
curl -fsSL https://docs.opentdf.io/quickstart/check.sh -o check.sh
chmod +x check.sh
./check.sh
```

### Install OpenTDF

Run the automated installer:

```shell
curl -fsSL https://opentdf.io/install.sh | bash
```

Or download and run locally:
```shell
curl -fsSL https://docs.opentdf.io/quickstart/install.sh -o install.sh
chmod +x install.sh
./install.sh
```

What this does:
- Downloads and installs the otdfctl CLI
- Verifies Docker is running
- Adds entries to /etc/hosts (requires sudo)
- Downloads and starts all services (Platform, Keycloak, PostgreSQL, Caddy)
- Imports SSL certificates (requires sudo)
- Takes 3-5 minutes on first run

You'll be prompted for your password twice:
1. To add entries to /etc/hosts
2. To import the SSL certificate

### Add otdfctl to Your PATH (Optional)

Choose one option:

Option A: Add to shell profile (recommended)
```shell
echo 'export PATH="$HOME/.opentdf/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc
```

Or for zsh:
```shell
echo 'export PATH="$HOME/.opentdf/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc
```

Option B: Create system-wide symlink
```shell
sudo ln -sf ~/.opentdf/bin/otdfctl /usr/local/bin/otdfctl
```

Option C: Use full path (no setup needed)
```shell
~/.opentdf/bin/otdfctl --version
```

### Verify Installation

```shell
otdfctl --version
```

Should display: otdfctl version 0.28.0 ...

You can verify that the platform and keycloak are running at the following locations
- https://platform.opentdf.local:8443/healthz
- https://keycloak.opentdf.local:9443/

### Create an otdfctl Profile

A profile stores your platform connection details:

```shell
otdfctl profile create platform-otdf-local https://platform.opentdf.local:8443
```

### Authenticate

Login using the pre-configured test credentials:

```shell
otdfctl --profile platform-otdf-local auth client-credentials opentdf secret
```

Credentials:
- Client ID: opentdf
- Client Secret: secret

These are test credentials provisioned automatically during installation.

To verify authentication, list namespaces to confirm you're connected:

```shell
otdfctl --profile platform-otdf-local policy attributes namespaces list
```

Should return an empty list [] (no namespaces created yet).

## Encrypt and Decrypt with the CLI

Let's start with a simple encryption example:

```shell
echo 'my first encrypted tdf' | otdfctl encrypt --profile platform-otdf-local -o example.tdf
```

This creates an encrypted file called `example.tdf`. Now decrypt it:

```shell
otdfctl decrypt --profile platform-otdf-local example.tdf
```

```shell
# Output
my first encrypted tdf
```

That's it! You're encrypting and decrypting data. But encryption alone isn't very useful without access controls, so let's get into the details of our scenario.

## Create A Namespace

A `namespace` is how you organize your `attributes` within the platform. Think of it as your organization's domain - for our scenario, this will be the company where Jen, Preston, and Jack work.

Let's check if there are any existing namespaces:

```shell
otdfctl --profile platform-otdf-local policy attributes namespaces list
```

```shell
SUCCESS   Found namespaces list
┌─────────────────────────┬───────────────────────────┬─────────────────────────────┬────────────────────────────┬────────────────────────────────┬────────────────────────────────┐
│Id                       │Name                       │Active                       │Labels                      │Created At                      │Updated At                      │
├─────────────────────────┼───────────────────────────┼─────────────────────────────┼────────────────────────────┼────────────────────────────────┼────────────────────────────────┤
└─────────────────────────┴───────────────────────────┴─────────────────────────────┴────────────────────────────┴────────────────────────────────┴────────────────────────────────┘
NOTE   Use 'namespaces get --id=<id> --json' to see all properties
```

### Create a new namespace

We'll create a namespace representing our company domain:

```shell
otdfctl --profile platform-otdf-local policy attributes namespaces create --name opentdf.io
```

```shell
SUCCESS   Created namespaces: 7650f02a-be00-4faa-a1d1-37cded5e23dc
┌────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                    │Value                                                                                                │
├────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Name                                                                        │opentdf.io                                                                                          │
│Id                                                                          │7650f02a-be00-4faa-a1d1-37cded5e23dc                                                                 │
│Created At                                                                  │Mon Jun 24 11:02:00 UTC 2024                                                                         │
│Updated At                                                                  │Mon Jun 24 11:02:00 UTC 2024                                                                         │
└────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'namespaces get --id=7650f02a-be00-4faa-a1d1-37cded5e23dc --json' to see all properties
```

### List the namespaces

With that namespace created we should be able to see it in the list of namespaces as well as get the details of the namespace.

```shell
otdfctl --profile platform-otdf-local policy attributes namespaces list
```

```shell
SUCCESS   Found namespaces list
┌──────────────────────────────────────────────┬────────────────────┬────────────────┬────────────────┬──────────────────────────────────────┬─────────────────────────────────────┐
│Id                                            │Name                │Active          │Labels          │Created At                            │Updated At                           │
├──────────────────────────────────────────────┼────────────────────┼────────────────┼────────────────┼──────────────────────────────────────┼─────────────────────────────────────┤
│7650f02a-be00-4faa-a1d1-37cded5e23dc          │opentdf.io          │true            │[]              │Mon Jun 24 11:02:00 UTC 2024          │Mon Jun 24 11:02:00 UTC 2024         │
└──────────────────────────────────────────────┴────────────────────┴────────────────┴────────────────┴──────────────────────────────────────┴─────────────────────────────────────┘
NOTE   Use 'namespaces get --id=<id> --json' to see all properties
```

Let's export the namespace id for later use.

```shell
export NAMESPACE_ID=<id>
```

### Get the details of the namespace

```shell
otdfctl --profile platform-otdf-local policy attributes namespaces get --id=$NAMESPACE_ID
```

```shell
SUCCESS   Found namespaces: 7650f02a-be00-4faa-a1d1-37cded5e23dc
┌────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                    │Value                                                                                                │
├────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                                                                          │7650f02a-be00-4faa-a1d1-37cded5e23dc                                                                 │
│Name                                                                        │opentdf.io                                                                                          │
│Created At                                                                  │Mon Jun 24 11:02:00 UTC 2024                                                                         │
│Updated At                                                                  │Mon Jun 24 11:02:00 UTC 2024                                                                         │
└────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'namespaces get --id=7650f02a-be00-4faa-a1d1-37cded5e23dc --json' to see all properties
```

## Create Attributes

An `attribute` defines how to classify data. For our scenario, we need two types of attributes:

1. **Department** - Which department can access the data (finance, engineering)
2. **Clearance** - What clearance level is required (executive, standard)

Each attribute has:

1. **A definition** - Describes how entitlements and resource attributes are compared:
   - **ANY_OF**: Entity needs at least one value (OR operation) - perfect for departments
   - **ALL_OF**: Entity needs all values (AND operation) - useful for combined requirements
   - **HIERARCHY**: Ordered list where higher values grant lower access - perfect for clearance levels

2. **A list of values** - The specific options (e.g., finance, engineering, executive, standard)

:::tip
You can create values when creating the definition: `--value finance --value engineering`
:::

### Create Department Attribute

First, let's create an attribute for departments. We'll use `ANY_OF` since a person typically belongs to one department:

```shell
otdfctl --profile platform-otdf-local policy attributes create --name department -s $NAMESPACE_ID -r ANY_OF
```

```shell
SUCCESS   Created attributes: bd02d7ab-564d-4b6c-95c4-3d4a8a259000
┌────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                        │Value                                                                                            │
├────────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────┤
│Name                                                                            │department                                                                                       │
│Rule                                                                            │ANY_OF                                                                                           │
│Values                                                                          │[]                                                                                               │
│Namespace                                                                       │opentdf.io                                                                                      │
│Created At                                                                      │Mon Jun 24 11:09:39 UTC 2024                                                                     │
│Updated At                                                                      │Mon Jun 24 11:09:39 UTC 2024                                                                     │
└────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'attributes get --id=bd02d7ab-564d-4b6c-95c4-3d4a8a259000 --json' to see all properties
```

Save the department attribute ID:

```shell
export DEPT_ATTRIBUTE_ID=<id>
```

### Add Department Values

Now add the specific departments. Preston works in finance, and Jack works in engineering:

```shell
# Finance department (Preston's department)
otdfctl --profile platform-otdf-local policy attributes values create -a $DEPT_ATTRIBUTE_ID --value finance
```

```shell
SUCCESS   Created values: 0fe7e8d0-a3ff-485f-ac24-a54d85904712
┌──────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                  │Value                                                                                                  │
├──────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                                                                        │0fe7e8d0-a3ff-485f-ac24-a54d85904712                                                                   │
│FQN                                                                       │https://opentdf.io/attr/department/value/finance                                                      │
│Value                                                                     │finance                                                                                                │
│Created At                                                                │Mon Jun 24 11:11:15 UTC 2024                                                                           │
│Updated At                                                                │Mon Jun 24 11:11:15 UTC 2024                                                                           │
└──────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'values get --id=0fe7e8d0-a3ff-485f-ac24-a54d85904712 --json' to see all properties
```

Save the finance value ID:

```shell
export FINANCE_VALUE_ID=<id>
```

```shell
# Engineering department (Jack's department)
otdfctl --profile platform-otdf-local policy attributes values create -a $DEPT_ATTRIBUTE_ID --value engineering
```

```shell
SUCCESS   Created values: dbfcbe15-7392-4e35-9e1d-3d06918472be
┌────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                │Value                                                                                                    │
├────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                                                                      │dbfcbe15-7392-4e35-9e1d-3d06918472be                                                                     │
│FQN                                                                     │https://opentdf.io/attr/department/value/engineering                                                    │
│Value                                                                   │engineering                                                                                              │
│Created At                                                              │Mon Jun 24 11:12:45 UTC 2024                                                                             │
│Updated At                                                              │Mon Jun 24 11:12:45 UTC 2024                                                                             │
└────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'values get --id=dbfcbe15-7392-4e35-9e1d-3d06918472be --json' to see all properties
```

Save the engineering value ID:

```shell
export ENGINEERING_VALUE_ID=<id>
```

### Create Clearance Attribute

Now create a clearance attribute using `HIERARCHY` rule. This means someone with executive clearance automatically has standard clearance too:

```shell
otdfctl --profile platform-otdf-local policy attributes create --name clearance -s $NAMESPACE_ID -r HIERARCHY
```

```shell
SUCCESS   Created attributes: af23c7bd-987d-4c6b-85f4-2a8d4a127abc
┌────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                        │Value                                                                                            │
├────────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────┤
│Name                                                                            │clearance                                                                                        │
│Rule                                                                            │HIERARCHY                                                                                        │
│Values                                                                          │[]                                                                                               │
│Namespace                                                                       │opentdf.io                                                                                      │
│Created At                                                                      │Mon Jun 24 11:09:39 UTC 2024                                                                     │
│Updated At                                                                      │Mon Jun 24 11:09:39 UTC 2024                                                                     │
└────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'attributes get --id=af23c7bd-987d-4c6b-85f4-2a8d4a127abc --json' to see all properties
```

Save the clearance attribute ID:

```shell
export CLEARANCE_ATTRIBUTE_ID=<id>
```

### Add Clearance Values

Add clearance levels. Order matters for HIERARCHY - list them from highest to lowest:

```shell
# Executive clearance (Jen has this - highest level)
otdfctl --profile platform-otdf-local policy attributes values create -a $CLEARANCE_ATTRIBUTE_ID --value executive
```

```shell
SUCCESS   Created values: 654f0877-2c0b-4a62-a9c3-87ed42bf77ac
┌──────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                  │Value                                                                                                  │
├──────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                                                                        │654f0877-2c0b-4a62-a9c3-87ed42bf77ac                                                                   │
│FQN                                                                       │https://opentdf.io/attr/clearance/value/executive                                                     │
│Value                                                                     │executive                                                                                              │
│Created At                                                                │Mon Jun 24 11:14:22 UTC 2024                                                                           │
│Updated At                                                                │Mon Jun 24 11:14:22 UTC 2024                                                                           │
└──────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'values get --id=654f0877-2c0b-4a62-a9c3-87ed42bf77ac --json' to see all properties
```

Save the executive clearance value ID:

```shell
export EXECUTIVE_VALUE_ID=<id>
```

```shell
# Standard clearance (Preston and Jack have this)
otdfctl --profile platform-otdf-local policy attributes values create -a $CLEARANCE_ATTRIBUTE_ID --value standard
```

```shell
SUCCESS   Created values: 789a1234-3c0b-4a62-b8d4-98fe53cf88bd
┌──────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                  │Value                                                                                                  │
├──────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                                                                        │789a1234-3c0b-4a62-b8d4-98fe53cf88bd                                                                   │
│FQN                                                                       │https://opentdf.io/attr/clearance/value/standard                                                      │
│Value                                                                     │standard                                                                                               │
│Created At                                                                │Mon Jun 24 11:14:22 UTC 2024                                                                           │
│Updated At                                                                │Mon Jun 24 11:14:22 UTC 2024                                                                           │
└──────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'values get --id=789a1234-3c0b-4a62-b8d4-98fe53cf88bd --json' to see all properties
```

Save the standard clearance value ID:

```shell
export STANDARD_VALUE_ID=<id>
```

### Review Your Attributes

Now you have two attributes with values. Let's verify the department attribute:

```shell
otdfctl --profile platform-otdf-local policy attributes get --id=$DEPT_ATTRIBUTE_ID
```

```shell
SUCCESS   Found attributes: bd02d7ab-564d-4b6c-95c4-3d4a8a259000
┌────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                    │Value                                                                                                │
├────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                                                                          │bd02d7ab-564d-4b6c-95c4-3d4a8a259000                                                                 │
│Name                                                                        │department                                                                                           │
│Rule                                                                        │ANY_OF                                                                                               │
│Values                                                                      │[finance, engineering]                                                                               │
│Namespace                                                                   │opentdf.io                                                                                          │
│Created At                                                                  │Mon Jun 24 11:09:39 UTC 2024                                                                         │
│Updated At                                                                  │Mon Jun 24 11:14:22 UTC 2024                                                                         │
└────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'attributes get --id=bd02d7ab-564d-4b6c-95c4-3d4a8a259000 --json' to see all properties
```

## Create Subject Mappings

A `subject mapping` connects users to attributes, granting them entitlements. This is where we define:
- **Jen** gets `clearance/executive` (which also grants `clearance/standard` due to hierarchy)
- **Preston** gets `department/finance` and `clearance/standard`
- **Jack** gets `department/engineering` and `clearance/standard`

First, we need a `subject condition set` - this defines WHO qualifies for the entitlement based on their identity properties (like client ID, email, or group membership).

### Create Subject Condition Sets

For this tutorial, we'll simulate our three users by creating condition sets that match different criteria. Download the <a target="_blank" href="/quickstart/subject_condition_set.json" download="subject_condition_set.json">example</a> subject condition set as a template.

In a real deployment, you'd match users by email, group membership, or other identity properties from your identity provider (like Keycloak). For now, we'll use the default client ID.

```shell
otdfctl --profile platform-otdf-local policy subject-condition-sets create -j <path to file>/subject_condition_set.json
```

```shell
SUCCESS   Created subject-condition-sets: 74bf521f-5a79-48fe-acb8-b4b63ee7950b
┌──────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property      │Value                                                                                                                                                              │
├──────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id            │74bf521f-5a79-48fe-acb8-b4b63ee7950b                                                                                                                               │
│SubjectSets   │[{"condition_groups":[{"conditions":[{"subject_external_selector_value":".clientId","operator":1,"subject_external_values":["opentdf"]}],"boolean_operator":1}]}]  │
│Created At    │Mon Jun 24 11:33:28 UTC 2024                                                                                                                                       │
│Updated At    │Mon Jun 24 11:33:28 UTC 2024                                                                                                                                       │
└──────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'subject-condition-sets get --id=74bf521f-5a79-48fe-acb8-b4b63ee7950b --json' to see all properties
```

Save the condition set ID - we'll use this to represent all three users in our demo:

```shell
export SUBJECT_CONDITION_SET_ID=<id>
```

## Encrypt Jen's Executive Document

Before granting any permissions, let's create Jen's executive strategy document and see what happens when someone without proper clearance tries to access it.

### Create the Executive Strategy Document

Jen creates her highly sensitive executive strategy document. This requires executive clearance:

```shell
echo 'Executive Financial Strategy 2026: Confidential merger plans and Board-level decisions' | otdfctl encrypt --profile platform-otdf-local -o executive-strategy.tdf --attr https://opentdf.io/attr/clearance/value/executive
```

### Try to Decrypt Without Permission (Will Fail)

Right now, we haven't granted ourselves any permissions. Let's try to decrypt this executive document:

```shell
otdfctl decrypt --profile platform-otdf-local executive-strategy.tdf
```

You'll see an error like this:

```shell
Error: rpc error: code = PermissionDenied desc = Access denied: insufficient permissions
```

This is access control working! The platform checked our entitlements, found that we don't have the `clearance/executive` attribute, and denied access.

### Grant Jen Executive Clearance

Now let's grant executive clearance to represent Jen's access level:

```shell
otdfctl --profile platform-otdf-local policy subject-mappings create --action read --attribute-value-id $EXECUTIVE_VALUE_ID --subject-condition-set-id $SUBJECT_CONDITION_SET_ID
```

```shell
SUCCESS   Created subject-mappings: 751054f8-14da-44c0-9341-5dab36b8256d
┌─────────────────────────┬────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                 │Value                                                                                                                                                   │
├─────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                       │751054f8-14da-44c0-9341-5dab36b8256d                                                                                                                    │
│Subject AttrVal: Id      │654f0877-2c0b-4a62-a9c3-87ed42bf77ac                                                                                                                    │
│Actions                  │[{"Value":{"Standard":1}}]                                                                                                                              │
│Subject Condition Set: I…│74bf521f-5a79-48fe-acb8-b4b63ee7950b                                                                                                                    │
│Subject Condition Set    │[{"condition_groups":[{"conditions":[{"subject_external_selector_value":".clientId","operator":1,"subject_external_values":["opentdf"]}],"boolean_opera…│
│Attribute Value Id       │654f0877-2c0b-4a62-a9c3-87ed42bf77ac                                                                                                                    │
│Created At               │Mon Jun 24 11:35:13 UTC 2024                                                                                                                            │
│Updated At               │Mon Jun 24 11:35:13 UTC 2024                                                                                                                            │
└─────────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'subject-mappings get --id=751054f8-14da-44c0-9341-5dab36b8256d --json' to see all properties
```

Because we're using HIERARCHY for clearance, this executive clearance automatically grants standard clearance too. This means Jen can access both executive-level documents and standard documents.

### Decrypt Now That We Have Permission

Now that we've been granted executive clearance, try decrypting the executive document again:

```shell
otdfctl decrypt --profile platform-otdf-local executive-strategy.tdf
```

```shell
# Output
Executive Financial Strategy 2026: Confidential merger plans and Board-level decisions
```

Success! With the proper clearance, Jen can now access her executive document. The same file that was locked before is now accessible.

## Create the Derivative Finance Report

Now Jen creates a derivative version for the finance team. This one requires finance department access but only standard clearance:

```shell
echo 'Finance Department Report 2026: Budget allocations and quarterly targets (no executive details)' | otdfctl encrypt --profile platform-otdf-local -o finance-report.tdf --attr https://opentdf.io/attr/department/value/finance --attr https://opentdf.io/attr/clearance/value/standard
```

Notice this document has TWO attributes - it requires BOTH finance department membership AND standard clearance.

### Grant Finance Department Access

To simulate Preston's access, let's grant ourselves the finance department attribute:

```shell
otdfctl --profile platform-otdf-local policy subject-mappings create --action read --attribute-value-id $FINANCE_VALUE_ID --subject-condition-set-id $SUBJECT_CONDITION_SET_ID
```

### Decrypt the Finance Report

Now we can access the derivative document (since we have executive clearance which includes standard, plus we just added finance department):

```shell
otdfctl decrypt --profile platform-otdf-local finance-report.tdf
```

```shell
# Output
Finance Department Report 2026: Budget allocations and quarterly targets (no executive details)
```

Success! Both Jen and Preston can now access this finance-specific document.

### What About Jack?

Jack (engineering department) cannot access either document because:
1. **Executive strategy**: Requires `clearance/executive` (Jack only has standard)
2. **Finance report**: Requires `department/finance` (Jack is in engineering)

This demonstrates attribute-based access control - the same encrypted files behave differently depending on WHO is trying to decrypt them.

## Takeaways and Next Steps

You've successfully implemented Jen, Preston, and Jack's scenario! Here's what you learned:

### Key Concepts

1. **Namespaces** organize attributes for your organization
2. **Attributes** classify data (department, clearance level, classification, etc.)
3. **Attribute Rules**:
   - `ANY_OF`: Need at least one value (departments)
   - `HIERARCHY`: Higher values include lower ones (clearance levels)
   - `ALL_OF`: Need all values (not used in this example)
4. **Subject Mappings** grant users entitlements to decrypt data with specific attributes
5. **Multiple Attributes** can be combined on a single document for fine-grained control

### Real-World Applications

In production, you would:
- Create unique users in Keycloak for Jen, Preston, and Jack
- Use subject condition sets that match by email, group membership, or custom claims
- Integrate with your existing identity provider
- Set up roles and groups in your IdP that map to attributes

### What's Next?

- Explore [SDK integration](/category/sdk) to encrypt/decrypt in your applications
- Learn about [Key Access Servers (KAS)](/components/key_access) for policy enforcement
- Understand [policy management](/components/policy) for access control
- Build [attribute hierarchies](/components/authorization) for complex organizational structures

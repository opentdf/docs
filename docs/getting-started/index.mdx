---
slug: /getting-started
---

import dockerComposeContent from '!!raw-loader!./docker-compose.yaml';
import CodeBlock from '@theme/CodeBlock';

<style>
{`
.download-button {
  display: inline-block;
  padding: 8px 16px;
  background-color: #0066cc;
  color: white;
  text-decoration: none;
  border-radius: 4px;
  margin-bottom: 16px;
  transition: all 0.2s ease;
}

.download-button:hover {
  background-color: #0052a3;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  color: white;
}

`}
</style>

# Getting Started

This guide will walk you through setting up a new platform locally and walk you through some of the basic concepts within the OpenTDF platform.

## Pre-requisites

- A copy of the `otdfctl` CLI.
  - [Download the latest release](https://github.com/opentdf/otdfctl/releases)
  
- A tool to run the compose file.
  - [Podman](https://podman.io/)
  - [Docker Compose](https://docs.docker.com/compose/)

## Update /etc/hosts

In order for the services to communicate correctly you will need to update your `/etc/hosts` file.

```shell
echo -e "127.0.0.1 platform.opentdf.local\n127.0.0.1 keycloak.opentdf.local" | sudo tee -a /etc/hosts
```

## Getting the Platform Running

The first step is to get the platform running locally. You can use the following docker compose file to get the platform running. This docker compose file will start a local instance of the [platform](https://github.com/opentdf/platform/tree/main), [Keycloak](https://www.keycloak.org/), and a [Postgres](https://www.postgresql.org/) database.

:::warning
Not for production use.
:::

<a href="/quickstart/docker-compose.yaml" download="docker-compose.yaml" className="download-button">Download docker-compose.yaml</a>

<details>
<summary>Docker Compose</summary>

<CodeBlock language="yaml">{dockerComposeContent}</CodeBlock>

</details>

### Save the Docker Compose File

Click the **download** button above to save the `docker-compose.yaml` file to your local machine. If you prefer to copy the content manually, save it as `docker-compose.yaml`.

### Start the Platform

Once you have the `docker-compose.yaml` file saved, start the platform using the following command:

```shell
# If running on Apple M4 chip
JAVA_OPTS_APPEND="-XX:UseSVE=0" docker compose --file docker-compose.yaml up -d

# Or on other architectures
docker compose --file docker-compose.yaml up -d
```

> **Note for Apple M4 chip users:**  
> The `JAVA_OPTS_APPEND="-XX:UseSVE=0"` environment variable resolves SIGILL with Code 134 errors when running Java processes (such as Keycloak).

## Trust Self Signed Certificates

After starting the platform, `caddy` will generate self-signed certificates during the bootstrapping process. You will either need to trust these certificates on your system or use the `--tls-no-verify` flag on every command. If using the `--tls-no-verify` command it will disable profiles and require that you pass in the host and authentication into each command.

First, extract the certificates from the container:

```shell
mkdir -p ./opentdf-certs
```

```shell
docker compose cp caddy:/data/caddy/certificates/local/keycloak.opentdf.local/keycloak.opentdf.local.crt ./opentdf-certs
```

```shell
docker compose cp caddy:/data/caddy/certificates/local/platform.opentdf.local/platform.opentdf.local.crt ./opentdf-certs
```

### Import and Trust Certificates by Operating System

<details>
<summary><strong>macOS</strong></summary>

1. **Import certificates to Keychain:**
   ```shell
   # Import both certificates to the System keychain
   sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ./opentdf-certs/keycloak.opentdf.local.crt
   sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ./opentdf-certs/platform.opentdf.local.crt
   ```

2. **Alternative: Using Keychain Access GUI:**
   - Open **Keychain Access** (Applications → Utilities → Keychain Access)
   - Drag and drop both `.crt` files into the **System** keychain
   - Double-click each certificate and set **Trust** → **When using this certificate** to **Always Trust**
   - Enter your admin password when prompted

3. **Verify certificates are trusted:**
   ```shell
   security verify-cert -c ./opentdf-certs/keycloak.opentdf.local.crt
   security verify-cert -c ./opentdf-certs/platform.opentdf.local.crt
   ```

**References:**
- [Add certificates to a keychain](https://support.apple.com/guide/keychain-access/add-certificates-to-a-keychain-kyca2431/mac)
- [Change trust settings of a certificate](https://support.apple.com/guide/keychain-access/change-the-trust-settings-of-a-certificate-kyca11871/mac)

</details>

<details>
<summary><strong>Windows</strong></summary>

1. **Import certificates using PowerShell (Run as Administrator):**
   ```powershell
   # Import to Trusted Root Certification Authorities
   Import-Certificate -FilePath ".\opentdf-certs\keycloak.opentdf.local.crt" -CertStoreLocation Cert:\LocalMachine\Root
   Import-Certificate -FilePath ".\opentdf-certs\platform.opentdf.local.crt" -CertStoreLocation Cert:\LocalMachine\Root
   ```

2. **Alternative: Using Certificate Manager GUI:**
   - Press `Win + R`, type `certmgr.msc`, and press Enter
   - Navigate to **Trusted Root Certification Authorities** → **Certificates**
   - Right-click and select **All Tasks** → **Import**
   - Follow the wizard to import both `.crt` files
   - Choose **Place all certificates in the following store** → **Trusted Root Certification Authorities**

3. **Alternative: Using MMC (Microsoft Management Console):**
   - Press `Win + R`, type `mmc`, and press Enter
   - Go to **File** → **Add/Remove Snap-in**
   - Add **Certificates** snap-in for **Local Computer**
   - Navigate to **Certificates (Local Computer)** → **Trusted Root Certification Authorities** → **Certificates**
   - Right-click and import both certificates

</details>

<details>
<summary><strong>Linux (Ubuntu/Debian)</strong></summary>

1. **Copy certificates to system certificate directory:**
   ```shell
   # Copy certificates to the ca-certificates directory
   sudo cp ./opentdf-certs/keycloak.opentdf.local.crt /usr/local/share/ca-certificates/
   sudo cp ./opentdf-certs/platform.opentdf.local.crt /usr/local/share/ca-certificates/
   
   # Update the certificate store
   sudo update-ca-certificates
   ```

2. **Verify certificates are installed:**
   ```shell
   # Check if certificates are in the trusted store
   awk -v cmd='openssl x509 -noout -subject' '/BEGIN/{close(cmd)};{print | cmd}' < /etc/ssl/certs/ca-certificates.crt | grep opentdf
   ```

</details>

<details>
<summary><strong>Linux (RHEL/CentOS/Fedora)</strong></summary>

1. **Copy certificates to system certificate directory:**
   ```shell
   # Copy certificates to the ca-trust directory
   sudo cp ./opentdf-certs/keycloak.opentdf.local.crt /etc/pki/ca-trust/source/anchors/
   sudo cp ./opentdf-certs/platform.opentdf.local.crt /etc/pki/ca-trust/source/anchors/
   
   # Update the certificate store
   sudo update-ca-trust
   ```

2. **Verify certificates are installed:**
   ```shell
   # Check if certificates are trusted
   trust list | grep "opentdf.local"
   ```

</details>

<details>
<summary><strong>Linux (Arch Linux)</strong></summary>

1. **Copy certificates to system certificate directory:**
   ```shell
   # Copy certificates to the ca-certificates directory
   sudo cp ./opentdf-certs/keycloak.opentdf.local.crt /etc/ca-certificates/trust-source/anchors/
   sudo cp ./opentdf-certs/platform.opentdf.local.crt /etc/ca-certificates/trust-source/anchors/
   
   # Update the certificate store
   sudo trust extract-compat
   ```

</details>

:::tip Browser-specific Certificate Installation
Some browsers (like Firefox) maintain their own certificate stores. If you continue to see certificate warnings in your browser after following the OS-specific steps above, you may need to import the certificates directly into your browser's certificate store.
:::

:::warning Certificate Validity
These self-signed certificates are only valid for local development. Never use self-signed certificates in production environments.
:::

## Create a Profile
Creating a profile allows us to store the host we want to connect to and then to tie our credentials to it when we login.

```shell
otdfctl profile create platform-otdf-local https://platform.opentdf.local:8443
```

## Login to the Platform

During the provisioning of the platform, a few test clients were created in **Keycloak**. You can use the following credentials to login to the platform. This will cache those credentials locally for the `otdfctl` CLI. You can also pass in the flags `--with-client-creds` and `--with-client-creds-file` on every command to authenticate with the platform.

```shell
otdfctl --profile platform-otdf-local auth client-credentials opentdf secret
```

## Create A Namespace

In this first step you are going to create a new `namespace`. A namespace is a way to organize your `attributes` within the platform.

You will see an empty list of namespaces when you first start the platform.

```shell
otdfctl --profile platform-otdf-local policy attributes namespaces list
```

```shell
SUCCESS   Found namespaces list
┌─────────────────────────┬───────────────────────────┬─────────────────────────────┬────────────────────────────┬────────────────────────────────┬────────────────────────────────┐
│Id                       │Name                       │Active                       │Labels                      │Created At                      │Updated At                      │
├─────────────────────────┼───────────────────────────┼─────────────────────────────┼────────────────────────────┼────────────────────────────────┼────────────────────────────────┤
└─────────────────────────┴───────────────────────────┴─────────────────────────────┴────────────────────────────┴────────────────────────────────┴────────────────────────────────┘
NOTE   Use 'namespaces get --id=<id> --json' to see all properties
```

### Create a new namespace

```shell
otdfctl --profile platform-otdf-local policy attributes namespaces create --name opentdf.io
```

```shell
SUCCESS   Created namespaces: 7650f02a-be00-4faa-a1d1-37cded5e23dc
┌────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                    │Value                                                                                                │
├────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Name                                                                        │opentdf.io                                                                                           │
│Id                                                                          │7650f02a-be00-4faa-a1d1-37cded5e23dc                                                                 │
│Created At                                                                  │Mon Jun 24 11:02:00 UTC 2024                                                                         │
│Updated At                                                                  │Mon Jun 24 11:02:00 UTC 2024                                                                         │
└────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'namespaces get --id=7650f02a-be00-4faa-a1d1-37cded5e23dc --json' to see all properties
```

### List the namespaces

With that namespace created we should be able to see it in the list of namespaces as well as get the details of the namespace.

```shell
otdfctl --profile platform-otdf-local policy attributes namespaces list
```
  
```shell
SUCCESS   Found namespaces list
┌──────────────────────────────────────────────┬────────────────────┬────────────────┬────────────────┬──────────────────────────────────────┬─────────────────────────────────────┐
│Id                                            │Name                │Active          │Labels          │Created At                            │Updated At                           │
├──────────────────────────────────────────────┼────────────────────┼────────────────┼────────────────┼──────────────────────────────────────┼─────────────────────────────────────┤
│7650f02a-be00-4faa-a1d1-37cded5e23dc          │opentdf.io          │true            │[]              │Mon Jun 24 11:02:00 UTC 2024          │Mon Jun 24 11:02:00 UTC 2024         │
└──────────────────────────────────────────────┴────────────────────┴────────────────┴────────────────┴──────────────────────────────────────┴─────────────────────────────────────┘
NOTE   Use 'namespaces get --id=<id> --json' to see all properties
```

Let's export the namespace id for later use.

```shell
export NAMESPACE_ID=<id>
```

### Get the details of the namespace

```shell
otdfctl --profile platform-otdf-local policy attributes namespaces get --id=$NAMESPACE_ID
```

```shell
SUCCESS   Found namespaces: 7650f02a-be00-4faa-a1d1-37cded5e23dc
┌────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                    │Value                                                                                                │
├────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                                                                          │7650f02a-be00-4faa-a1d1-37cded5e23dc                                                                 │
│Name                                                                        │opentdf.io                                                                                           │
│Created At                                                                  │Mon Jun 24 11:02:00 UTC 2024                                                                         │
│Updated At                                                                  │Mon Jun 24 11:02:00 UTC 2024                                                                         │
└────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'namespaces get --id=7650f02a-be00-4faa-a1d1-37cded5e23dc --json' to see all properties
```

## Create an Attribute

Now that we have a namespace we can create a new attribute. An attribute is a way to define a classification for your data.

It consists of two main parts:

1. A `definition` which describes how an entities entitlements and resource attributes are compared.
    1. **ANY_OF**: The entity must have at least one of the values in the list. This is your typical `OR` operation.
    2. **ALL_OF**: The entity must have all of the values in the list. This is your typical `AND` operation.
    3. **HIERARCHY**: This is an ordered list of values. The entity must have an equal or greater value in the list.

2. A list of `values`

:::warning

Attribute name and values are case insensitive. This means `ROLE` is equal to `role`.

:::

:::tip

You can also create values at the same time when creating the definition. This is useful when you know the values you want to use. (e.g. --value admin --value developer --value guest)

:::

### Create attribute definition

```shell
otdfctl --profile platform-otdf-local policy attributes create --name role  -s $NAMESPACE_ID  -r ANY_OF
```

```shell
SUCCESS   Created attributes: bd02d7ab-564d-4b6c-95c4-3d4a8a259000
┌────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                        │Value                                                                                            │
├────────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────┤
│Name                                                                            │role                                                                                             │
│Rule                                                                            │ANY_OF                                                                                           │
│Values                                                                          │[]                                                                                               │
│Namespace                                                                       │opentdf.io                                                                                       │
│Created At                                                                      │Mon Jun 24 11:09:39 UTC 2024                                                                     │
│Updated At                                                                      │Mon Jun 24 11:09:39 UTC 2024                                                                     │
└────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'attributes get --id=bd02d7ab-564d-4b6c-95c4-3d4a8a259000 --json' to see all properties
```

Let's export the attribute id for later use.

```shell
export ATTRIBUTE_ID=<id>
```

### Create attribute values

```shell
# Create admin value
otdfctl --profile platform-otdf-local policy attributes values create -a $ATTRIBUTE_ID --value admin
```

```shell
SUCCESS   Created values: 0fe7e8d0-a3ff-485f-ac24-a54d85904712
┌──────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                  │Value                                                                                                  │
├──────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                                                                        │0fe7e8d0-a3ff-485f-ac24-a54d85904712                                                                   │
│FQN                                                                       │https://opentdf.io/attr/role/value/admin                                                               │
│Value                                                                     │admin                                                                                                  │
│Created At                                                                │Mon Jun 24 11:11:15 UTC 2024                                                                           │
│Updated At                                                                │Mon Jun 24 11:11:15 UTC 2024                                                                           │
└──────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'values get --id=0fe7e8d0-a3ff-485f-ac24-a54d85904712 --json' to see all properties
```

Export the admin value id for later use.

```shell
export ADMIN_VALUE_ID=<id>
```

```shell
# Create developer value
otdfctl --profile platform-otdf-local policy attributes values create -a $ATTRIBUTE_ID --value developer
```

```shell
SUCCESS   Created values: dbfcbe15-7392-4e35-9e1d-3d06918472be
┌────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                │Value                                                                                                    │
├────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                                                                      │dbfcbe15-7392-4e35-9e1d-3d06918472be                                                                     │
│FQN                                                                     │https://opentdf.io/attr/role/value/developer                                                             │
│Value                                                                   │developer                                                                                                │
│Created At                                                              │Mon Jun 24 11:12:45 UTC 2024                                                                             │
│Updated At                                                              │Mon Jun 24 11:12:45 UTC 2024                                                                             │
└────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'values get --id=dbfcbe15-7392-4e35-9e1d-3d06918472be --json' to see all properties
```

Export the developer value id for later use.

```shell
export DEVELOPER_VALUE_ID=<id>
```

```shell
# Create guest value
otdfctl --profile platform-otdf-local policy attributes values create -a $ATTRIBUTE_ID --value guest
```

```shell
SUCCESS   Created values: 654f0877-2c0b-4a62-a9c3-87ed42bf77ac
┌──────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                  │Value                                                                                                  │
├──────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                                                                        │654f0877-2c0b-4a62-a9c3-87ed42bf77ac                                                                   │
│FQN                                                                       │https://opentdf.io/attr/role/value/guest                                                               │
│Value                                                                     │guest                                                                                                  │
│Created At                                                                │Mon Jun 24 11:14:22 UTC 2024                                                                           │
│Updated At                                                                │Mon Jun 24 11:14:22 UTC 2024                                                                           │
└──────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'values get --id=654f0877-2c0b-4a62-a9c3-87ed42bf77ac --json' to see all properties
```

Export the guest value id for later use.

```shell
export GUEST_VALUE_ID=<id>
```

### Get the attribute details

Now that we have listed values for the attribute, we can get the details of the attribute. You should see the added values in the list now.

```shell
otdfctl --profile platform-otdf-local policy attributes get --id=$ATTRIBUTE_ID
```

```shell
SUCCESS   Found attributes: bd02d7ab-564d-4b6c-95c4-3d4a8a259000
┌────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                                                                    │Value                                                                                                │
├────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                                                                          │bd02d7ab-564d-4b6c-95c4-3d4a8a259000                                                                 │
│Name                                                                        │role                                                                                                 │
│Rule                                                                        │ANY_OF                                                                                               │
│Values                                                                      │[admin, developer, guest]                                                                            │
│Namespace                                                                   │opentdf.io                                                                                           │
│Created At                                                                  │Mon Jun 24 11:09:39 UTC 2024                                                                         │
│Updated At                                                                  │Mon Jun 24 11:14:22 UTC 2024                                                                         │
└────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'attributes get --id=bd02d7ab-564d-4b6c-95c4-3d4a8a259000 --json' to see all properties
```

## Create a Subject Mapping

A `subject mapping` is a way to define how a user or entity is mapped to an attribute in the **OpenTDF Platform**.

An attribute that is mapped to an entity is considered an `entitlement`. An `entitlement` is a way to define what tdf resources an entity can access.

With `subject mappings` there is a sub-resource  called `subject condition sets`. These are a set of conditions that must be met for the `subject mapping` to be applied.

### Create a Subject Condition Set

Download the <a target="_blank" href="/quickstart/subject_condition_set.json" download="subject_condition_set.json">example</a> subject condition set. You can use this file to create a new condition set.

```shell
 otdfctl --profile platform-otdf-local policy subject-condition-sets create -j <path to file>/subject_condition_set.json
```

```shell
SUCCESS   Created subject-condition-sets: 74bf521f-5a79-48fe-acb8-b4b63ee7950b
┌──────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property      │Value                                                                                                                                                              │
├──────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id            │74bf521f-5a79-48fe-acb8-b4b63ee7950b                                                                                                                               │
│SubjectSets   │[{"condition_groups":[{"conditions":[{"subject_external_selector_value":".clientId","operator":1,"subject_external_values":["opentdf"]}],"boolean_operator":1}]}]  │
│Created At    │Mon Jun 24 11:33:28 UTC 2024                                                                                                                                       │
│Updated At    │Mon Jun 24 11:33:28 UTC 2024                                                                                                                                       │
└──────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'subject-condition-sets get --id=74bf521f-5a79-48fe-acb8-b4b63ee7950b --json' to see all properties
```

Let's export the subject condition set id for later use.

```shell
export SUBJECT_CONDITION_SET_ID=<id>
```

### Create a Subject Mapping

With the condition set created we can now create a new subject mapping that is tied to the subject condition set.

```shell
otdfctl --profile platform-otdf-local policy subject-mappings create --action read --attribute-value-id $DEVELOPER_VALUE_ID --subject-condition-set-id $SUBJECT_CONDITION_SET_ID
```

```shell
SUCCESS   Created subject-mappings: 751054f8-14da-44c0-9341-5dab36b8256d
┌─────────────────────────┬────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                 │Value                                                                                                                                                   │
├─────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                       │751054f8-14da-44c0-9341-5dab36b8256d                                                                                                                    │
│Subject AttrVal: Id      │dbfcbe15-7392-4e35-9e1d-3d06918472be                                                                                                                    │
│Actions                  │[{"Value":{"Standard":1}}]                                                                                                                              │
│Subject Condition Set: I…│74bf521f-5a79-48fe-acb8-b4b63ee7950b                                                                                                                    │
│Subject Condition Set    │[{"condition_groups":[{"conditions":[{"subject_external_selector_value":".clientId","operator":1,"subject_external_values":["opentdf"]}],"boolean_opera…│
│Attribute Value Id       │dbfcbe15-7392-4e35-9e1d-3d06918472be                                                                                                                    │
│Created At               │Mon Jun 24 11:35:13 UTC 2024                                                                                                                            │
│Updated At               │Mon Jun 24 11:35:13 UTC 2024                                                                                                                            │
└─────────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'subject-mappings get --id=751054f8-14da-44c0-9341-5dab36b8256d --json' to see all properties
```

Let's export the subject mapping id for later use.

```shell
export SUBJECT_MAPPING_ID=<id>
```

## Encrypt Some Data With TDF

Now that we have a few basic resources in place we can show you how to control access to data using the **OpenTDF Platform**.

### Encrypt Data Without Attributes

Within the `otdfctl` CLI there is basic functionality to interact with `zTDF`.

#### Example zTDF encryption

```shell
echo 'my first encrypted tdf' | otdfctl encrypt --profile platform-otdf-local -o example.tdf --tdf-type tdf3
```

### Decrypt Data Without Attributes

Because we didn't add any attributes to the data we encrypted, we should be able to decrypt the data without any issues.

```shell
otdfctl decrypt --profile platform-otdf-local --tdf-type tdf3 example.tdf
```

```shell
# Output
my first encrypted tdf
```

### Encrypt Data With Attributes

In this example we will encrypt the data with the attribute `https://opentdf.io/attr/role/value/guest`. First cleanup any existing tdf files from before.

```shell
rm example.tdf
```

#### Example zTDF encryption with attributes

```shell
echo 'my first encrypted tdf' | otdfctl encrypt --profile platform-otdf-local -o example.tdf --tdf-type tdf3 --attr https://opentdf.io/attr/role/value/guest
```

### Decrypt Data With Attributes

In this first example we will try to decrypt the data but it will fail because we shouldn't be assigned the entitlement of `https://opentdf.io/attr/role/value/guest` at this point.

#### Example zTDF failed decryption

```shell
otdfctl decrypt --profile platform-otdf-local --tdf-type tdf3 example.tdf
```

```shell
# Output
ERROR    Failed to decrypt file: reader.WriteTo failed: doPayloadKeyUnwrap splitKey.rewrap failed: error making request to kas: error making rewrap request: rpc error: code = PermissionDenied desc = request error
            rpc error: code = PermissionDenied desc = forbidden
```

What we have to do now is assign the entitlement of `https://opentdf.io/attr/role/value/guest` to the entity by creating a new subject mapping for the condition set we created earlier.

#### Create a new subject mapping

```shell
otdfctl --profile platform-otdf-local policy subject-mappings create --action read --attribute-value-id $GUEST_VALUE_ID --subject-condition-set-id $SUBJECT_CONDITION_SET_ID
```

```shell
SUCCESS   Created subject-mappings: f6bf9fc7-e23b-4276-9dfc-7a61f359edfd
┌─────────────────────────┬────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Property                 │Value                                                                                                                                                   │
├─────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Id                       │f6bf9fc7-e23b-4276-9dfc-7a61f359edfd                                                                                                                    │
│Subject AttrVal: Id      │654f0877-2c0b-4a62-a9c3-87ed42bf77ac                                                                                                                    │
│Actions                  │[{"Value":{"Standard":1}}]                                                                                                                              │
│Subject Condition Set: I…│74bf521f-5a79-48fe-acb8-b4b63ee7950b                                                                                                                    │
│Subject Condition Set    │[{"condition_groups":[{"conditions":[{"subject_external_selector_value":".clientId","operator":1,"subject_external_values":["opentdf"]}],"boolean_opera…│
│Attribute Value Id       │654f0877-2c0b-4a62-a9c3-87ed42bf77ac                                                                                                                    │
│Created At               │Mon Jun 24 13:28:22 UTC 2024                                                                                                                            │
│Updated At               │Mon Jun 24 13:28:22 UTC 2024                                                                                                                            │
└─────────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
NOTE   Use 'subject-mappings get --id=f6bf9fc7-e23b-4276-9dfc-7a61f359edfd --json' to see all properties
```

Now that we have the subject mapping in place we should be able to decrypt the data.

#### Example zTDF successful decryption

```shell
otdfctl decrypt --profile platform-otdf-local --tdf-type tdf3 example.tdf
```

```shell
# Output
my first encrypted tdf
```

## Takeaways and Next Steps

In this document you have learned how to create a namespace, attribute, subject mapping, and encrypt/decrypt data with the **OpenTDF Platform**.
